"use strict";(self.webpackChunkresponsive_navbar_website=self.webpackChunkresponsive_navbar_website||[]).push([[140],{1140:(e,r,o)=>{o.r(r),o.d(r,{default:()=>n});var t=o(5043),i=o(5475),s=o(1740),a=o(8171),l=o(579);const n=()=>{const e=(0,i.Zp)(),[r,o]=(0,t.useState)("");return(0,t.useEffect)(()=>{(async()=>{try{const{data:{session:t},error:i}=await s.N.auth.getSession();if(i)throw console.error("AuthCallback Debug - Session error:",i),i;if(!t||!t.user)return console.log("AuthCallback Debug - No valid session found"),void e("/signin",{replace:!0});console.log("AuthCallback Debug - Valid session for user:",t.user.email);const{data:l,error:n}=await s.N.from("profiles").select("role, email, id").eq("id",t.user.id).single();if(n&&"PGRST116"!==n.code)return console.error("AuthCallback Debug - Profile query error:",n),o("Error loading user profile. Please try signing in again."),void setTimeout(()=>e("/signin",{replace:!0}),2e3);if(l){if(console.log("AuthCallback Debug - Profile found:",l),console.log("AuthCallback Debug - Role:",l.role),!l.role)return console.log("AuthCallback Debug - Profile exists but no role assigned"),o("Account setup incomplete. Redirecting..."),void setTimeout(()=>e("/signin",{replace:!0}),2e3);if(console.log("AuthCallback Debug - Redirecting authenticated user based on role:",l.role),"admin"===l.role)console.log("\ud83d\udc51 AuthCallback Debug - ADMIN DETECTED - Redirecting to admin"),e("/admin",{replace:!0});else if("veterinarian"===l.role)console.log("\ud83c\udfe5 AuthCallback Debug - VETERINARIAN DETECTED - Redirecting to veterinarian-portal"),e("/veterinarian-portal",{replace:!0});else if("vet_nurse"===l.role)console.log("\ud83d\udc69\u200d\u2695\ufe0f AuthCallback Debug - VET NURSE DETECTED - Redirecting to vet-nurse-dashboard"),e("/vet-nurse-dashboard",{replace:!0});else{let r=l.role;if("provider"===l.role){console.log("AuthCallback Debug - User is a provider, checking provider_type...");const{data:e,error:o}=await s.N.from("providers").select("provider_type").eq("user_id",t.user.id).single();console.log("AuthCallback Debug - Provider query result:",{providerData:e,providerError:o}),"groomer"===(null===e||void 0===e?void 0:e.provider_type)&&(r="groomer",console.log("AuthCallback Debug - Setting effectiveRole to groomer"))}const o=(0,a.q5)(r);console.log("\ud83d\udc64 AuthCallback Debug - Redirecting user to:",o,"effectiveRole:",r),e(o,{replace:!0})}}else{console.log("AuthCallback Debug - No profile found for OAuth user:",t.user.email);const i=new Date-new Date(t.user.created_at);if(!(i<3e5))return o("Profile setup required. Please complete your registration."),void setTimeout(()=>e("/signup",{replace:!0}),2e3);console.log("AuthCallback Debug - New OAuth account detected, checking for provider record...");try{const{data:r}=await s.N.from("providers").select("provider_type").eq("user_id",t.user.id).single();if(null!==r&&void 0!==r&&r.provider_type){console.log("AuthCallback Debug - Found provider type:",r.provider_type);let o="provider";"groomer"===r.provider_type?o="groomer":"trainer"===r.provider_type?o="trainer":"breeder"===r.provider_type?o="breeder":"nutritionist"===r.provider_type?o="nutritionist":"pet_business"===r.provider_type?o="pet_business":"holistic_care"===r.provider_type&&(o="holistic_care");const t=(0,a.q5)(o);console.log("AuthCallback Debug - Redirecting OAuth provider to:",t),e(t,{replace:!0})}else console.log("AuthCallback Debug - No provider record found, defaulting to pet owner dashboard"),e("/pet-owner-dashboard",{replace:!0})}catch(r){console.log("AuthCallback Debug - Error checking provider record, defaulting to pet owner dashboard"),e("/pet-owner-dashboard",{replace:!0})}}}catch(t){o("Authentication failed. Redirecting to sign in..."),setTimeout(()=>e("/signin",{replace:!0}),1500)}})()},[e]),(0,l.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-[#5EB47C] mx-auto mb-4"}),(0,l.jsx)("p",{className:"text-gray-600 font-montserrat",children:"Completing sign-in..."}),r&&(0,l.jsx)("p",{className:"text-red-600 mt-2 font-montserrat text-sm",children:r})]})})}},8171:(e,r,o)=>{o.d(r,{Dz:()=>a,iK:()=>i,q5:()=>s});var t=o(1740);const i={PET_OWNER:"pet_owner",VETERINARIAN:"veterinarian",VET_NURSE:"vet_nurse",GROOMER:"groomer",TRAINER:"trainer",BREEDER:"breeder",NUTRITIONIST:"nutritionist",PET_BUSINESS:"pet_business",HOLISTIC_CARE:"holistic_care",ADMIN:"admin",SUPPORT:"support"},s=e=>({[i.PET_OWNER]:"/pet-owner-dashboard",[i.VETERINARIAN]:"/veterinarian-portal",[i.VET_NURSE]:"/vet-nurse-dashboard",[i.GROOMER]:"/groomer-dashboard",[i.TRAINER]:"/trainer-dashboard",[i.BREEDER]:"/breeder-dashboard",[i.NUTRITIONIST]:"/nutritionist-dashboard",[i.PET_BUSINESS]:"/pet-business-dashboard",[i.HOLISTIC_CARE]:"/holistic-care-dashboard",[i.ADMIN]:"/admin",[i.SUPPORT]:"/support-dashboard"}[e]||"/pet-owner-dashboard"),a=async()=>{try{var e,r;const{data:{user:o},error:a}=await t.N.auth.getUser();if(a||!o)return{success:!1,error:"Not authenticated",shouldRedirect:!0,redirectTo:"/signin"};const l=(null===(e=o.user_metadata)||void 0===e?void 0:e.role)||(null===(r=o.app_metadata)||void 0===r?void 0:r.role)||i.PET_OWNER;return l===i.PET_OWNER||l===i.ADMIN?{success:!0,user:o,role:l}:{success:!1,error:"Access denied - wrong role",shouldRedirect:!0,redirectTo:s(l),role:l}}catch(o){return console.error("Error checking pet owner access:",o),{success:!1,error:o.message||"Failed to verify access",shouldRedirect:!0,redirectTo:"/signin"}}}}}]);
//# sourceMappingURL=140.e31b243b.chunk.js.map