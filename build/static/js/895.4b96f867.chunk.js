"use strict";(self.webpackChunkresponsive_navbar_website=self.webpackChunkresponsive_navbar_website||[]).push([[895],{2878:(e,t,s)=>{s.d(t,{A:()=>n});var r=s(1740),a=s(5064);const n={async getPetCaseHistory(e){try{const{data:t,error:s}=await r.N.from("case_history").select("*").eq("pet_id",e).order("created_at",{ascending:!1});return s?{success:!1,error:(0,a.nl)(s),data:[]}:{success:!0,data:t||[]}}catch(t){return{success:!1,error:(0,a.nl)(t),data:[]}}},async getUserCaseHistory(e){try{const{data:t,error:s}=await r.N.from("case_history").select("*").eq("user_id",e).order("created_at",{ascending:!1});return s?{success:!1,error:(0,a.nl)(s),data:[]}:{success:!0,data:t||[]}}catch(t){return{success:!1,error:(0,a.nl)(t),data:[]}}},async getCase(e){try{const{data:t,error:s}=await r.N.from("case_history").select("*").eq("id",e).single();return s?{success:!1,error:(0,a.nl)(s),data:null}:{success:!0,data:t}}catch(t){return{success:!1,error:(0,a.nl)(t),data:null}}},async createCase(e){try{const{data:t,error:s}=await r.N.from("case_history").insert([e]).select().single();return s?{success:!1,error:(0,a.nl)(s),data:null}:{success:!0,data:t}}catch(t){return{success:!1,error:(0,a.nl)(t),data:null}}},async updateCase(e,t){try{const{data:s,error:n}=await r.N.from("case_history").update(t).eq("id",e).select().single();return n?{success:!1,error:(0,a.nl)(n),data:null}:{success:!0,data:s}}catch(s){return{success:!1,error:(0,a.nl)(s),data:null}}}}},3624:(e,t,s)=>{s.d(t,{A:()=>r});s(4344);const r={async analyzeSymptoms(e,t){try{return{success:!0,data:{urgency:"moderate",recommendations:["Monitor your pet closely for the next 24 hours","Contact a veterinarian if symptoms worsen","Ensure your pet stays hydrated"],possibleCauses:["Infection","Dietary issue","Stress"],nextSteps:"Schedule a veterinary consultation within 48 hours"}}}catch(s){return{success:!1,error:s.message||"Failed to analyze symptoms"}}},async generateHealthReport(e){try{return{success:!0,data:{report:"Health report generated successfully",timestamp:(new Date).toISOString()}}}catch(t){return{success:!1,error:t.message||"Failed to generate health report"}}},async getTriageRecommendation(e,t){try{return{success:!0,data:{urgency:"routine",recommendation:"Schedule a routine checkup",confidence:.85}}}catch(s){return{success:!1,error:s.message||"Failed to get recommendation"}}}}},6895:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var r=s(5043),a=s(1056),n=s(3624);const i={async processPayment(e){try{return{success:!0,data:{transactionId:`txn_${Date.now()}`,status:"completed",amount:e.amount,currency:e.currency||"NZD"}}}catch(t){return{success:!1,error:t.message||"Payment processing failed"}}},async getPaymentHistory(e){try{return{success:!0,data:[]}}catch(t){return{success:!1,error:t.message||"Failed to get payment history",data:[]}}},async refundPayment(e){try{return{success:!0,data:{transactionId:e,status:"refunded"}}}catch(t){return{success:!1,error:t.message||"Refund failed"}}}};var o=s(1740),l=s(5064);const c={async createTriage(e){try{const{data:t,error:s}=await o.N.from("triage_cases").insert([{...e,status:"pending",created_at:(new Date).toISOString()}]).select().single();return s?{success:!1,error:(0,l.nl)(s),data:null}:{success:!0,data:t}}catch(t){return{success:!1,error:(0,l.nl)(t),data:null}}},async getTriage(e){try{const{data:t,error:s}=await o.N.from("triage_cases").select("*").eq("id",e).single();return s?{success:!1,error:(0,l.nl)(s),data:null}:{success:!0,data:t}}catch(t){return{success:!1,error:(0,l.nl)(t),data:null}}},async getUserTriages(e){try{const{data:t,error:s}=await o.N.from("triage_cases").select("*").eq("user_id",e).order("created_at",{ascending:!1});return s?{success:!1,error:(0,l.nl)(s),data:[]}:{success:!0,data:t||[]}}catch(t){return{success:!1,error:(0,l.nl)(t),data:[]}}},async updateTriageStatus(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const{data:r,error:a}=await o.N.from("triage_cases").update({status:t,notes:s,updated_at:(new Date).toISOString()}).eq("id",e).select().single();return a?{success:!1,error:(0,l.nl)(a),data:null}:{success:!0,data:r}}catch(r){return{success:!1,error:(0,l.nl)(r),data:null}}}};var d=s(2878),m=s(7445);const g={async getMedicalHistory(e){try{const{data:t,error:s}=await o.N.from("medical_history").select("*").eq("pet_id",e).order("date",{ascending:!1});return s?{success:!1,error:(0,l.nl)(s),data:[]}:{success:!0,data:t||[]}}catch(t){return{success:!1,error:(0,l.nl)(t),data:[]}}},async addMedicalHistory(e){try{const{data:t,error:s}=await o.N.from("medical_history").insert([e]).select().single();return s?{success:!1,error:(0,l.nl)(s),data:null}:{success:!0,data:t}}catch(t){return{success:!1,error:(0,l.nl)(t),data:null}}},async updateMedicalHistory(e,t){try{const{data:s,error:r}=await o.N.from("medical_history").update(t).eq("id",e).select().single();return r?{success:!1,error:(0,l.nl)(r),data:null}:{success:!0,data:s}}catch(s){return{success:!1,error:(0,l.nl)(s),data:null}}},async deleteMedicalHistory(e){try{const{error:t}=await o.N.from("medical_history").delete().eq("id",e);return t?{success:!1,error:(0,l.nl)(t)}:{success:!0}}catch(t){return{success:!1,error:(0,l.nl)(t)}}}};var u=s(7078),h=s(673);const x=new class{constructor(){this.metrics=new Map,this.marks=new Map}startMeasure(e){"performance"in window&&"mark"in window.performance&&(window.performance.mark(`${e}-start`),this.marks.set(e,Date.now()))}endMeasure(e){if("performance"in window&&"mark"in window.performance){window.performance.mark(`${e}-end`);try{window.performance.measure(e,`${e}-start`,`${e}-end`);const t=window.performance.getEntriesByName(e)[0];t&&(this.metrics.set(e,t.duration),console.log(`\u23f1\ufe0f ${e}: ${t.duration.toFixed(2)}ms`),window.performance.clearMarks(`${e}-start`),window.performance.clearMarks(`${e}-end`),window.performance.clearMeasures(e))}catch(t){console.warn("Performance measurement error:",t)}}if(this.marks.has(e)){const t=Date.now()-this.marks.get(e);this.metrics.set(e,t),console.log(`\u23f1\ufe0f ${e}: ${t}ms (fallback)`),this.marks.delete(e)}}getMetric(e){return this.metrics.get(e)||0}getAllMetrics(){return Object.fromEntries(this.metrics)}clearMetrics(){this.metrics.clear(),this.marks.clear()}logPageLoad(){if("performance"in window&&"timing"in window.performance){const e=window.performance.timing,t={"DNS Lookup":e.domainLookupEnd-e.domainLookupStart,"TCP Connection":e.connectEnd-e.connectStart,Request:e.responseStart-e.requestStart,Response:e.responseEnd-e.responseStart,"DOM Processing":e.domComplete-e.domLoading,"Total Load Time":e.loadEventEnd-e.navigationStart};return console.log("\ud83d\udcca Page Load Performance:",t),t}return{}}monitorRender(e,t){this.startMeasure(`${e}-render`);const s=t();return this.endMeasure(`${e}-render`),s}getMemoryUsage(){return"memory"in performance?{usedJSHeapSize:(performance.memory.usedJSHeapSize/1048576).toFixed(2)+" MB",totalJSHeapSize:(performance.memory.totalJSHeapSize/1048576).toFixed(2)+" MB",jsHeapSizeLimit:(performance.memory.jsHeapSizeLimit/1048576).toFixed(2)+" MB"}:null}report(){console.log("\ud83d\udcca Performance Report:"),console.table(this.getAllMetrics());const e=this.getMemoryUsage();e&&console.log("\ud83d\udcbe Memory Usage:",e)}};"undefined"!==typeof window&&(window.performanceMonitor=x);var p=s(579);const y=()=>{const[e,t]=(0,r.useState)(null),[s,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{},[]),null},b=e=>{if(!e.content)return"";let t=e.content;return t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),"soap"===e.type&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/^<strong>(SUBJECTIVE|OBJECTIVE|ASSESSMENT|PLAN|RECOMMENDATIONS|DISCLAIMER):<\/strong>$/gm,'<div class="soap-section-header"><strong>$1:</strong></div>').replace(/^<strong>PET HEALTH SUMMARY<\/strong>$/gm,'<div class="soap-title"><strong>PET HEALTH SUMMARY</strong></div>').replace(/^<strong>(Case ID|Date\/Time|Veterinary Authority|Guidelines|Triage Classification):<\/strong>/gm,'<div class="soap-header-item"><strong>$1:</strong></div>').replace(/^<strong>\*\*SIGNALMENT:\*\*<\/strong>$/gm,'<div class="soap-section-header"><strong>SIGNALMENT</strong></div>').replace(/^<strong>\*\*(SUBJECTIVE|OBJECTIVE|ASSESSMENT|PLAN|VETERINARY REFERRAL REQUIRED|EMERGENCY INDICATORS|LIMITATIONS OF REMOTE ASSESSMENT|COMPLIANCE NOTES):\*\*<\/strong>$/gm,'<div class="soap-section-header"><strong>$1</strong></div>').replace(/^<strong>\u2022 (.*?):<\/strong>/gm,'<div class="soap-subsection"><strong>\u2022 $1:</strong></div>').replace(/\b(Emergency)\b/g,'<span class="severity-emergency"><strong>$1</strong></span>').replace(/\b(Serious)\b/g,'<span class="severity-serious"><strong>$1</strong></span>').replace(/\b(Moderate)\b/g,'<span class="severity-moderate"><strong>$1</strong></span>').replace(/\b(Mild)\b/g,'<span class="severity-mild"><strong>$1</strong></span>').replace(/\b(EMERGENCY)\b/g,'<span class="severity-emergency"><strong>$1</strong></span>').replace(/\b(SERIOUS)\b/g,'<span class="severity-serious"><strong>$1</strong></span>').replace(/\b(MODERATE)\b/g,'<span class="severity-moderate"><strong>$1</strong></span>').replace(/\b(MILD)\b/g,'<span class="severity-mild"><strong>$1</strong></span>').replace(/\b(IMMEDIATE|URGENT|CRITICAL|LIFE-THREATENING)\b/g,'<span class="medical-urgent"><strong>$1</strong></span>').replace(/\b(immediate|urgent|critical|life-threatening)\b/g,'<span class="medical-urgent"><strong>$1</strong></span>')),"user"!==e.type&&"soap"!==e.type&&"image"!==e.type&&(t=t.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\b(Emergency|Serious|Moderate|Mild)\b/g,"<strong>$1</strong>").replace(/\b(EMERGENCY|SERIOUS|MODERATE|MILD)\b/g,"<strong>$1</strong>").replace(/\b(IMMEDIATE|URGENT|CRITICAL|LIFE-THREATENING)\b/g,"<strong>$1</strong>").replace(/\b(immediate|urgent|critical|life-threatening)\b/g,"<strong>$1</strong>").replace(/\b(Seek immediate veterinary attention|Contact your veterinarian|Emergency veterinary care|Veterinary examination required)\b/gi,"<strong>$1</strong>").replace(/\b(Assessment complete|Triage assessment|Pet Health Summary|Medical assessment)\b/gi,"<strong>$1</strong>").replace(/\b(Warning|Caution|Important|Note|Alert)\b:/gi,"<strong>$1</strong>:").replace(/\b(within \d+\s*(?:hour|hours|minute|minutes))\b/gi,"<strong>$1</strong>").replace(/\b(immediately|right away|as soon as possible|ASAP)\b/gi,"<strong>$1</strong>")),t=t.replace(/\n/g,"<br>"),t},v=()=>{const{showSuccess:e,showError:t}=(0,h.M)(),s="luni_triage_chat_data",l=(0,r.useCallback)(e=>{try{return JSON.stringify(e).replace(/\s+/g," ").trim()}catch(t){return console.warn("Data compression failed:",t),JSON.stringify(e)}},[]),x=(0,r.useCallback)(e=>{const t={chatHistory:e.chatHistory,currentChatId:e.currentChatId,selectedRegion:e.selectedRegion,currentAnalysis:e.currentAnalysis,currentSeverity:e.currentSeverity,timestamp:(new Date).toISOString()};try{const e=l(t);localStorage.setItem(s,e)}catch(r){console.warn("Failed to save chat data to localStorage:",r);try{Object.keys(localStorage).forEach(e=>{e.startsWith("luni_")&&e!==s&&localStorage.removeItem(e)}),localStorage.setItem(s,l(t))}catch(a){console.error("Failed to save even after cleanup:",a)}}},[l]),v=(0,r.useCallback)(()=>{try{const e=localStorage.getItem(s);if(e){const t=JSON.parse(e),r=new Date-new Date(t.timestamp);if(r<864e5&&t.chatHistory&&Array.isArray(t.chatHistory)&&t.chatHistory.length>0&&t.chatHistory.every(e=>e.id&&e.messages&&Array.isArray(e.messages)))return t;localStorage.removeItem(s)}}catch(e){console.warn("Failed to load chat data from localStorage:",e),localStorage.removeItem(s)}return null},[]),[f,w]=((0,r.useCallback)(()=>{try{localStorage.removeItem(s)}catch(e){console.warn("Failed to clear chat data from localStorage:",e)}},[]),(0,r.useState)([])),[j,N]=(0,r.useState)(""),[S,k]=(0,r.useState)(!1),[C,A]=(0,r.useState)(!1),[E,I]=(0,r.useState)(null),[P,M]=(0,r.useState)([]),[L,D]=(0,r.useState)("NZ"),[R,H]=(0,r.useState)(!1),[T,O]=(0,r.useState)(""),[B,F]=(0,r.useState)(!1),[$,z]=(0,r.useState)(""),[_,U]=(0,r.useState)(!1),[,V]=(0,r.useState)([]),[G,W]=(0,r.useState)(!1),[q,Z]=(0,r.useState)(!1),[Y,J]=(0,r.useState)(null),[K,Q]=(0,r.useState)(!1),[X,ee]=(0,r.useState)(null),[te,se]=(0,r.useState)(""),[re,ae]=(0,r.useState)(null),[ne,ie]=(0,r.useState)([]),[oe,le]=(0,r.useState)(!1),[ce,de]=(0,r.useState)(null),[me,ge]=(0,r.useState)("soap"),[ue,he]=(0,r.useState)(!1),[xe,pe]=(0,r.useState)(!0),[ye,be]=(0,r.useState)(null),[ve,fe]=(0,r.useState)(null),[we,je]=(0,r.useState)(!1),[Ne,Se]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{const{data:{user:e},error:t}=await o.N.auth.getUser();if(e&&!t){ae(e);const t=await m.A.getUserPets(e.id);t.success&&ie(t.data)}}catch(e){console.error("Error checking user authentication:",e)}})();return(0,u.yg)(async(e,t)=>{if("SIGNED_IN"!==e&&"INITIAL_SESSION"!==e||null===t||void 0===t||!t.user)"SIGNED_OUT"===e&&(ae(null),ie([]));else{ae(t.user);const e=await m.A.getUserPets(t.user.id);e.success&&ie(e.data)}})},[]),(0,r.useEffect)(()=>{const e=()=>{window.scrollTo({top:0,left:0,behavior:"instant"})};window.innerWidth<=768&&(e(),setTimeout(e,100))},[]);const[ke,Ce]=(0,r.useState)({criteria:{emergencyScreening:!1,petSpecies:!1,petAge:!1,mainSymptoms:!1,durationSymptoms:!1,eatingDrinking:!1,behavioralChanges:!1,lifestyleFactors:!1,preventativeCare:!1,medicalHistory:!1},completedCriteria:0,progressPercentage:0,stage:"Getting Started",emergencyDetected:!1,medicalHistory:!1}),[Ae,Ee]=(0,r.useState)(0),[Ie,Pe]=(0,r.useState)("Moderate"),[Me,Le]=(0,r.useState)(!1),[De,Re]=(0,r.useState)(!1),He=(0,r.useRef)(null),Te=(0,r.useRef)(null),Oe=(0,r.useRef)(null),Be=(0,r.useRef)({}),Fe=(0,r.useRef)(null),$e={AU:{name:"Australia",currency:"AUD",authority:"AVA",pricing:{newCase:2.49,vetNurseReview:6.99,onlineConsultation:19.99},guidelines:"AVA Professional Guidelines",standards:"AVA Standards of Veterinary Practice",terminology:"AVA-approved veterinary terminology and clinical language",emergencyProtocols:"AVA Emergency Response Protocols",documentationStandards:"AVA Medical Record Standards",clinicalFramework:"AVA Clinical Decision-Making Framework"},NZ:{name:"New Zealand",currency:"NZD",authority:"NZVA",pricing:{newCase:2.99,vetNurseReview:7.99,onlineConsultation:22.99},guidelines:"NZVA Professional Guidelines",standards:"NZVA Professional Standards and Guidelines",terminology:"NZVA-approved veterinary terminology and clinical language",emergencyProtocols:"NZVA Emergency Care Guidelines",documentationStandards:"NZVA Clinical Documentation Standards",clinicalFramework:"NZVA Clinical Assessment Framework"}},ze=(0,r.useMemo)(()=>$e[L],[L]),_e=(0,r.useCallback)(e=>e,[]),Ue=(0,r.useCallback)(e=>`$${e.toFixed(2)}`,[]);(0,r.useEffect)(()=>{(async()=>{const e=v();if(e){if(M(e.chatHistory),D(e.selectedRegion),Ce(e.currentAnalysis||{criteria:{emergencyScreening:!1,petSpecies:!1,petAge:!1,mainSymptoms:!1,durationSymptoms:!1,eatingDrinking:!1,behavioralChanges:!1,lifestyleFactors:!1,preventativeCare:!1,medicalHistory:!1},completedCriteria:0,progressPercentage:0,stage:"Getting Started",emergencyDetected:!1,medicalHistory:!1}),Pe(e.currentSeverity||"Moderate"),e.currentChatId){const t=e.chatHistory.find(t=>t.id===e.currentChatId);if(t)I(e.currentChatId),w(t.messages),A(t.locked||!1);else{const t=e.chatHistory[e.chatHistory.length-1];t&&(I(t.id),w(t.messages),A(t.locked||!1))}}}else 0===P.length&&Ge()})()},[]),(0,r.useEffect)(()=>{Ve()},[f]),(0,r.useEffect)(()=>{if(P.length>0){x({chatHistory:P,currentChatId:E,selectedRegion:L,currentAnalysis:ke,currentSeverity:Ie})}},[P,E,L,ke,Ie,x]),(0,r.useEffect)(()=>{const e=e=>{Oe.current&&!Oe.current.contains(e.target)&&Z(!1),Fe.current&&!Fe.current.contains(e.target)&&Q(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]),(0,r.useEffect)(()=>{_||(Z(!1),J(null),Q(!1))},[_]),(0,r.useEffect)(()=>{const e=e=>{if(Y){const t=Be.current[Y],s=document.querySelector(`[data-dropdown-id="${Y}"]`);!t||t.contains(e.target)||s&&s.contains(e.target)||J(null)}};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[Y]);const Ve=(0,r.useCallback)(()=>{var e;null===(e=He.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[]),Ge=(0,r.useCallback)(()=>{const e=(0,a.v4)(),t={id:(0,a.v4)(),type:"ai",content:"Hi! I'm **Luni**, your virtual vet AI. I'll perform a veterinary triage by asking a few quick questions to understand your pet better and assess their situation.\n\nYou'll get a professional Health Report summary of your pet's health and clear triage-based next steps that can help guide your care decisions.\n\n**Let's get started:**\n\nWhat concerns do you have about your pet today? Please start with the most urgent or worrying symptoms.\n\n\ud83d\udcf8 **Pro tip:** You can also upload an image of your pet or the symptoms for better AI visual analysis!",timestamp:(new Date).toISOString()},s={id:e,title:`Case ${P.length+1}`,messages:[t],healthReport:null,locked:!1,createdAt:(new Date).toISOString(),region:L,analysis:{criteria:{emergencyScreening:!1,petSpecies:!1,petAge:!1,mainSymptoms:!1,durationSymptoms:!1,eatingDrinking:!1,behavioralChanges:!1,lifestyleFactors:!1,preventativeCare:!1,medicalHistory:!1},completedCriteria:0,progressPercentage:0,stage:"Getting Started",emergencyDetected:!1,medicalHistory:!1}};M(e=>[...e,s]),I(e),w([t]),A(!1),Ce(null),Pe("Moderate")},[P.length,L]),We=(0,r.useCallback)(e=>{M(t=>t.map(t=>t.id===E?{...t,messages:e}:t))},[E]),qe=(0,r.useCallback)(async t=>{const s=t.replace(/<br>/g,"\n").replace(/<\/strong>/g,"").replace(/<strong>/g,"").replace(/<\/div>/g,"\n").replace(/<div[^>]*>/g,"").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/<[^>]*>/g,"").replace(/\*\*/g,"").replace(/\n\s*\n\s*\n/g,"\n\n").trim();try{await navigator.clipboard.writeText(s),e("Pet Health Summary copied to clipboard!")}catch(r){const t=document.createElement("textarea");t.value=s,document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy"),e("Pet Health Summary copied to clipboard!")}catch(a){console.error("Failed to copy text: ",a)}document.body.removeChild(t)}},[e]),Ze=(0,r.useCallback)(async s=>{if(!s)return fe(null),void Se(!1);try{console.log("\ud83c\udfe5 Loading medical history for pet:",s);const t=await g.getPetMedicalSummary(s);var r;if(t.success&&t.data)fe(t.data),Se(!0),console.log("\u2705 Medical history loaded:",t.data),Ce(e=>({...e,medicalHistory:!0})),e(`Medical history loaded for ${(null===(r=t.data.pet_info)||void 0===r?void 0:r.name)||"your pet"}`);else console.log("\u2139\ufe0f No medical history found for pet"),fe(null),Se(!1)}catch(a){console.error("Error loading medical history:",a),t("Failed to load medical history"),fe(null),Se(!1)}},[e,t]),Ye=(0,r.useCallback)(async e=>{if(be(e),je(!1),e){await Ze(e.id);const t={id:(0,a.v4)(),type:"system",content:`\ud83c\udfe5 Medical history loaded for ${e.name}. This information will be automatically considered in the assessment.`,timestamp:(new Date).toISOString()};w(e=>[...e,t]),We([...f,t])}else fe(null),Se(!1),Ce(e=>({...e,medicalHistory:!1}))},[f,We,Ze]),Je=(0,r.useCallback)(()=>ve&&Ne?g.generateMedicalContextForAI(ve):null,[ve,Ne]),Ke=e=>new Promise((t,s)=>{const r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>s(e)}),Qe=async function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{return await n.A.analyzeImageWithVision(e,t,ze,s)}catch(r){throw console.error("Error in image analysis:",r),r}},Xe=async e=>{try{const s=await rt(e),r={id:(0,a.v4)(),type:"ai",content:s.content,timestamp:(new Date).toISOString()},i=[...e,r];if(w(i),We(i),s.analysis&&(Ce(s.analysis),!s.severity&&i.length>=3))try{const e=await n.A.assessSeverityFromSymptoms(i,ze);Pe(e)}catch(t){console.error("Failed to assess severity:",t)}s.severity&&Pe(s.severity),s.shouldGenerateSOAP&&await it(i,s.analysis)}catch(t){console.error("Error getting AI response to image:",t);const s={id:(0,a.v4)(),type:"ai",content:"I see the image analysis, but encountered an error processing it. Please continue describing your pet's condition.",timestamp:(new Date).toISOString()},r=[...e,s];w(r),We(r)}},et=()=>{X&&te.trim()&&(M(e=>e.map(e=>e.id===X?{...e,title:te.trim()}:e)),ee(null),se(""))},tt=()=>{ee(null),se("")},st=(0,r.useCallback)(async()=>{if(!j.trim()||S||C)return;const e={id:(0,a.v4)(),type:"user",content:j.trim(),timestamp:(new Date).toISOString()},t=[...f,e];w(t),N(""),k(!0);const s=(0,a.v4)(),r={id:s,type:"ai",content:"",timestamp:(new Date).toISOString(),isStreaming:!0},i=[...t,r];w(i),k(!1);let o=null;const l=c.analyzeCompletionCriteria(t,n.A,ke).then(e=>(console.log("\ud83d\udd0d Analysis Result:",e),console.log("\ud83d\udcca Criteria Details (AI-ONLY DETECTION):"),console.log("  - petConcerns:",e.criteria.petConcerns),console.log("  - petSpecies:",e.criteria.petSpecies),console.log("  - petAge:",e.criteria.petAge),console.log("  - durationSymptoms:",e.criteria.durationSymptoms),console.log("  - eatingDrinking:",e.criteria.eatingDrinking),console.log("  - behavioralChanges:",e.criteria.behavioralChanges),console.log("  - medicalHistory:",e.criteria.medicalHistory),console.log("\ud83d\udcc8 Progress:",`${e.completedCriteria}/7 (${e.progressPercentage}%)`),console.log("\ud83c\udfaf Stage:",e.stage),console.log("\u2705 Complete?",e.isComplete),console.log("\ud83e\udd16 Assessment Progress Update: AI detected",e.completedCriteria,"out of 7 criteria"),Ce(e),Ee(e=>e+1),e.emergencyDetected&&!De&&(Re(!0),Le(!0)),M(t=>t.map(t=>t.id===E?{...t,analysis:e}:t)),e)).catch(e=>{throw console.error("AI analysis failed during message processing:",e),A(!0),Pe("AI Service Unavailable"),e});try{o=await l;const e=await at(t,o,(e,t)=>{w(e=>e.map(e=>e.id===s?{...e,content:t}:e))});k(!1);const a={...r,content:e.content,isStreaming:!1},n=[...t,a];w(n),M(e=>e.map(e=>e.id===E?{...e,messages:n}:e));const i={};e.analysis&&(i.analysis=e.analysis,Ce(e.analysis),Ee(e=>e+1),e.analysis.emergencyDetected&&!De&&(Re(!0),Le(!0)),M(t=>t.map(t=>t.id===E?{...t,analysis:e.analysis}:t))),e.severity&&(i.severity=e.severity,Pe(e.severity)),e.shouldGenerateSOAP&&nt(n,e.analysis,e.severity)}catch(u){var d,m,g;console.error("Error calling OpenAI:",u),k(!1);let e="I apologize, but I encountered an error. Please try again or contact support if the issue persists.";u.message.includes("API key")?e="\ud83d\udd11 API Key Error: The OpenAI API key is missing or invalid. Please check the system configuration.":401===(null===(d=u.response)||void 0===d?void 0:d.status)?e="\ud83d\udd10 Authentication Error: Invalid API key. Please verify the OpenAI API key is correct.":429===(null===(m=u.response)||void 0===m?void 0:m.status)?e="\u23f1\ufe0f Rate Limit Error: Too many requests. Please wait a moment and try again.":500===(null===(g=u.response)||void 0===g?void 0:g.status)?e="\ud83d\udd27 Server Error: OpenAI service is temporarily unavailable. Please try again in a few minutes.":u.message.includes("Network Error")?e="\ud83c\udf10 Network Error: Unable to connect to OpenAI. Please check your internet connection.":u.message.includes("AI Service Unavailable")&&(e="\u26a0\ufe0f Our AI assessment system is currently unavailable. Please try again later or contact support if the issue persists.",A(!0),Pe("AI Service Unavailable"));const s={id:(0,a.v4)(),type:"ai",content:e,timestamp:(new Date).toISOString(),isError:!0};w(e=>[...e.filter(e=>!e.isStreaming),s]),k(!1),M(e=>e.map(e=>e.id===E?{...e,messages:[...t,s],locked:!!u.message.includes("AI Service Unavailable")}:e))}finally{k(!1)}},[j,S,C,f,ke,E,ze]),rt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{const s=Je();return await n.A.generateTriageResponse(e,ze,t,null,s)}catch(s){throw console.error("Error calling OpenAI service:",s),new Error("Failed to get AI response - OpenAI API key required")}},at=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{const r=Je();return await n.A.generateTriageResponse(e,ze,t,s,r)}catch(r){throw console.error("Error calling OpenAI service with streaming:",r),new Error("Failed to get AI response - OpenAI API key required")}},nt=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r=(0,a.v4)(),n={id:r,type:"soap",content:"",timestamp:(new Date).toISOString(),severity:s||Ie,isStreaming:!0};w(e=>[...e,n]);try{const n=await ot(e,t,s,(e,t)=>{w(e=>e.map(e=>e.id===r?{...e,content:t}:e))}),i=s||Ie;s&&Pe(s);const o={id:(0,a.v4)(),createdAt:(new Date).toISOString(),region:L,content:n,analysis:t,severity:i};A(!0),M(e=>e.map(e=>e.id===E?{...e,healthReport:o,locked:!0}:e));const l={id:r,type:"soap",content:n,timestamp:(new Date).toISOString(),severity:i,isStreaming:!1};w(e=>e.map(e=>e.id===r?l:e)),setTimeout(()=>{w(e=>(We(e),e))},100)}catch(o){var i;console.error("Error generating Pet Health Summary:",o);let e="\ud83d\udccb Pet Health Summary Error: Unable to generate assessment summary. The triage analysis is complete, but document generation failed.";o.message.includes("API key")?e="\ud83d\udd11 SOAP Generation Error: API key issue prevented document creation.":429===(null===(i=o.response)||void 0===i?void 0:i.status)&&(e="\u23f1\ufe0f SOAP Generation Error: Rate limit reached. Assessment complete but document generation delayed.");const t={id:r,type:"soap",content:e,timestamp:(new Date).toISOString(),severity:s||Ie,isError:!0,isStreaming:!1};w(e=>e.map(e=>e.id===r?t:e))}},it=nt,ot=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{const i=Je(),o=await n.A.generateHealthReport(e,ze,"Assessment completed through AI triage",t,s,r,i);if(ye&&re&&o)try{await g.addLuniTriageToTimeline(ye.id,re.id,{title:`Luni Triage Assessment - ${(new Date).toLocaleDateString()}`,description:`AI triage assessment completed. Severity: ${s||Ie}`,severity:s||Ie,metadata:{chat_id:E,analysis:t,soap_generated:!0,region:L}}),console.log("\u2705 Triage assessment saved to medical timeline")}catch(a){console.error("Failed to save triage to timeline:",a)}return o}catch(i){throw console.error("Error generating Pet Health Summary:",i),new Error("Failed to generate Pet Health Summary - OpenAI API key required")}},lt=async()=>{F(!0),z("");try{const t=ze.pricing["newCase"===T?"newCase":"vetReview"===T?"vetNurseReview":"onlineConsultation"],s=i.getPaymentDescription(T,ze.name),r=await i.processPayment(t,ze.currency,s,T);if(r.success)switch(await i.storePaymentRecord(r.payment,"current_user_id",E),H(!1),T){case"newCase":Ge();break;case"vetReview":e("Payment successful! Veterinarian review requested. You will be contacted within 2 hours.");break;case"consultation":e("Payment successful! Online consultation booked. You will receive a meeting link shortly.")}}catch(t){z(t.message)}finally{F(!1)}},ct=()=>(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4",children:(0,p.jsxs)("div",{className:"bg-white rounded-2xl max-w-lg w-full mx-4 relative shadow-2xl",children:[(0,p.jsx)("button",{onClick:()=>{H(!1),z("")},disabled:B,className:"absolute top-5 right-5 text-gray-400 hover:text-gray-600 disabled:opacity-50 z-10 p-1 rounded-full hover:bg-gray-100 transition-colors",children:(0,p.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,p.jsxs)("div",{className:"bg-gradient-to-r from-[#5EB47C] to-[#4A9B63] p-6 rounded-t-2xl text-white",children:[(0,p.jsx)("div",{className:"mb-2",children:(0,p.jsx)("h3",{className:"text-2xl font-bold",children:"Choose Your Service"})}),(0,p.jsx)("p",{className:"text-green-100 text-sm",children:"Select the service that best fits your pet's needs"})]}),(0,p.jsxs)("div",{className:"p-6",children:[$&&(0,p.jsx)("div",{className:"mb-6 p-4 bg-red-50 border-l-4 border-red-400 rounded-r-lg",children:(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("svg",{className:"w-5 h-5 text-red-400 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),(0,p.jsx)("span",{className:"text-red-700 text-sm font-medium",children:$})]})}),(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsx)("button",{className:"w-full p-5 border-2 border-gray-200 rounded-xl hover:border-[#5EB47C] hover:shadow-lg cursor-pointer transition-all duration-300 text-left disabled:opacity-50 disabled:cursor-not-allowed group",onClick:async()=>{O("newCase"),await lt()},disabled:B,children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-start",children:[(0,p.jsx)("div",{className:"bg-green-100 p-3 rounded-lg mr-4 group-hover:bg-green-200 transition-colors",children:(0,p.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"font-bold text-gray-900 mb-1 text-lg",children:"New Case Assessment"}),(0,p.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:"AI-powered initial assessment for your pet's symptoms and condition"})]})]}),(0,p.jsxs)("div",{className:"text-right ml-4",children:[(0,p.jsx)("div",{className:"text-2xl font-bold text-[#5EB47C] mb-1",children:Ue(ze.pricing.newCase,ze.currency)}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:_e(ze.currency)}),B&&"newCase"===T&&(0,p.jsxs)("div",{className:"flex items-center justify-end",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#5EB47C] mr-2"}),(0,p.jsx)("span",{className:"text-xs text-[#5EB47C] font-medium",children:"Processing..."})]})]})]})}),(0,p.jsx)("button",{className:"w-full p-5 border-2 border-gray-200 rounded-xl hover:border-[#5EB47C] hover:shadow-lg cursor-pointer transition-all duration-300 text-left disabled:opacity-50 disabled:cursor-not-allowed group",onClick:async()=>{O("vetReview"),await lt()},disabled:B,children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-start",children:[(0,p.jsx)("div",{className:"bg-green-100 p-3 rounded-lg mr-4 group-hover:bg-green-200 transition-colors",children:(0,p.jsx)("svg",{className:"w-6 h-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"font-bold text-gray-900 mb-1 text-lg",children:"Vet Nurse Review"}),(0,p.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:"Professional assessment by qualified veterinary nurse within 2 hours"})]})]}),(0,p.jsxs)("div",{className:"text-right ml-4",children:[(0,p.jsx)("div",{className:"text-2xl font-bold text-[#5EB47C] mb-1",children:Ue(ze.pricing.vetNurseReview,ze.currency)}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:_e(ze.currency)}),B&&"vetReview"===T&&(0,p.jsxs)("div",{className:"flex items-center justify-end",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#3B82F6] mr-2"}),(0,p.jsx)("span",{className:"text-xs text-[#3B82F6] font-medium",children:"Processing..."})]})]})]})}),(0,p.jsx)("button",{className:"w-full p-5 border-2 border-gray-200 rounded-xl hover:border-[#5EB47C] hover:shadow-lg cursor-pointer transition-all duration-300 text-left disabled:opacity-50 disabled:cursor-not-allowed group",onClick:async()=>{O("consultation"),await lt()},disabled:B,children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-start",children:[(0,p.jsx)("div",{className:"bg-purple-100 p-3 rounded-lg mr-4 group-hover:bg-purple-200 transition-colors",children:(0,p.jsx)("svg",{className:"w-6 h-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"font-bold text-gray-900 mb-1 text-lg",children:"Online Consultation"}),(0,p.jsx)("p",{className:"text-sm text-gray-600 leading-relaxed",children:"Full veterinary consultation with licensed vet via video call"})]})]}),(0,p.jsxs)("div",{className:"text-right ml-4",children:[(0,p.jsx)("div",{className:"text-2xl font-bold text-[#5EB47C] mb-1",children:Ue(ze.pricing.onlineConsultation,ze.currency)}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:_e(ze.currency)}),B&&"consultation"===T&&(0,p.jsxs)("div",{className:"flex items-center justify-end",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#3B82F6] mr-2"}),(0,p.jsx)("span",{className:"text-xs text-[#3B82F6] font-medium",children:"Processing..."})]})]})]})})]})]}),(0,p.jsx)("div",{className:"px-6 pb-6",children:(0,p.jsxs)("div",{className:"flex items-center justify-center text-xs text-gray-500 bg-gray-50 p-3 rounded-lg",children:[(0,p.jsx)("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),(0,p.jsx)("span",{children:"Secure payment processing \u2022 No card details stored"})]})})]})});return(0,p.jsxs)("div",{className:"flex h-[calc(100vh-5rem)] bg-gray-100 mt-0 relative "+(_?"overflow-hidden":""),children:[_&&(0,p.jsx)("div",{className:"md:hidden fixed inset-0 bg-black bg-opacity-50 z-[60]",onClick:()=>U(!1),onTouchMove:e=>e.preventDefault(),style:{touchAction:"none"}}),(0,p.jsxs)("div",{className:(_?"block":"hidden")+" md:block w-80 bg-white border-r border-gray-200 flex flex-col md:relative md:z-0 z-[100] md:h-full fixed top-0 left-0 bottom-0 md:overflow-y-auto overflow-hidden",children:[(0,p.jsxs)("div",{className:"p-4 border-b border-gray-200 relative",ref:Oe,children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,p.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Guideline Region"}),(0,p.jsx)("button",{onClick:()=>U(!1),className:"md:hidden p-1 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-[#3B82F6]","aria-label":"Close sidebar",children:(0,p.jsx)("svg",{className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsxs)("button",{onClick:()=>Z(!q),className:"w-full p-2 border border-gray-300 rounded-md bg-white text-left flex items-center justify-between hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-[#3B82F6] focus:border-transparent",children:[(0,p.jsx)("span",{className:"flex items-center",children:"AU"===L?"Australia":"New Zealand"}),(0,p.jsx)("svg",{className:"w-4 h-4 transition-transform "+(q?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),q&&(0,p.jsxs)("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-xl ring-1 ring-black ring-opacity-5 z-50 overflow-hidden",children:[(0,p.jsx)("button",{onClick:()=>{D("NZ"),Z(!1)},className:"w-full p-3 text-left hover:bg-gray-50 "+("NZ"===L?"bg-[#DBEAFE] text-[#2563EB]":"text-gray-900"),children:(0,p.jsx)("div",{className:"flex items-center mb-1",children:"New Zealand"})}),(0,p.jsx)("button",{onClick:()=>{D("AU"),Z(!1)},className:"w-full p-3 text-left hover:bg-gray-50 border-t border-gray-200 "+("AU"===L?"bg-[#DBEAFE] text-[#2563EB]":"text-gray-900"),children:(0,p.jsx)("div",{className:"flex items-center mb-1",children:"Australia"})})]})]}),(0,p.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Pricing in ",_e(ze.currency)]})]}),xe&&(0,p.jsx)("div",{className:"px-4 py-3 border-b border-gray-200 bg-gray-100",children:(0,p.jsxs)("div",{className:"flex items-start justify-between",children:[(0,p.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,p.jsx)("svg",{className:"w-5 h-5 text-gray-600 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-sm font-medium text-gray-900",children:"Get 1 free Triage Case weekly"}),(0,p.jsx)("p",{className:"text-xs text-gray-700 mt-1",children:"Paid session available"}),(0,p.jsxs)("p",{className:"text-xs text-gray-600 mt-2",children:[(0,p.jsx)("a",{href:"/disclaimer",className:"text-blue-600 hover:text-blue-800 underline",children:"Disclaimer"}),": Supportive guidance, not diagnosis."]})]})]}),(0,p.jsx)("button",{onClick:()=>pe(!1),className:"p-1 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-200 transition-colors",title:"Close",children:(0,p.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),re&&ne.length>0&&(0,p.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,p.jsx)("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Select Pet for Triage"}),ye?(0,p.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-md p-3",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:"text-lg mr-2",children:"dog"===ye.species?"\ud83d\udc15":"cat"===ye.species?"\ud83d\udc31":"\ud83d\udc3e"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"font-medium text-green-800",children:ye.name}),(0,p.jsx)("p",{className:"text-xs text-green-600",children:Ne?"\u2705 Medical history loaded":"\ud83d\udccb Basic info only"})]})]}),(0,p.jsx)("button",{onClick:()=>je(!0),className:"text-green-600 hover:text-green-800 text-sm",title:"Change pet",children:"Change"})]})}):(0,p.jsxs)("button",{onClick:()=>je(!0),className:"w-full bg-blue-50 border-2 border-dashed border-blue-300 rounded-md p-3 text-blue-600 hover:bg-blue-100 hover:border-blue-400 transition-colors",children:[(0,p.jsx)("div",{className:"flex items-center justify-center",children:(0,p.jsx)("span",{children:"Select Your Pet"})}),(0,p.jsx)("p",{className:"text-xs text-blue-500 mt-1",children:"Get personalized assessment with medical history"})]})]}),(0,p.jsx)("div",{className:"p-4 border-b border-gray-200",children:(0,p.jsx)("button",{onClick:()=>(O("newCase"),void H(!0)),className:"w-full bg-[#5EB47C] text-white py-2 px-4 rounded-md hover:bg-[#4A9A64] flex items-center justify-center",children:"New Case"})}),ke&&(0,p.jsxs)("div",{className:"p-4 border-b border-gray-200 "+(C?"bg-green-50":"bg-gray-50"),children:[(0,p.jsx)("h4",{className:"text-base font-medium text-gray-700 mb-3",children:C?"Assessment Complete":"Assessment Progress"}),(0,p.jsx)("div",{className:"space-y-2",children:Object.entries({petConcerns:"Pet Concerns",petSpecies:"Pet Species",petAge:"Pet Age",durationSymptoms:"Duration",eatingDrinking:"Eating & Drinking",behavioralChanges:"Behavior",medicalHistory:"Medical History & Care"}).map(e=>{let[t,s]=e;const r=ke&&ke.criteria&&!0===ke.criteria[t];return(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("span",{className:"text-xs text-gray-600",children:s}),(0,p.jsx)("span",{className:"text-xs "+(r?"text-green-600":"text-gray-400"),children:r?"\u2705":"\u2b55"})]},t)})}),(0,p.jsx)("div",{className:"mt-3 pt-2 border-t border-gray-200",children:(0,p.jsxs)("div",{className:"flex justify-between items-center",children:[(0,p.jsxs)("span",{className:"text-xs font-medium text-gray-700",children:[ke.completedCriteria,"/7 Complete"]}),(0,p.jsx)("span",{className:"text-xs font-medium "+(ke.emergencyDetected?"text-amber-600":ke.progressPercentage>=100?"text-green-600":ke.progressPercentage>=90?"text-green-500":ke.progressPercentage>=75?"text-blue-600":ke.progressPercentage>=55?"text-yellow-600":ke.progressPercentage>=35?"text-orange-600":"text-gray-600"),children:ke.stage})]})})]},Ae),(0,p.jsx)("div",{className:"flex-1 overflow-y-auto",children:(0,p.jsxs)("div",{className:"p-4",children:[(0,p.jsx)("h3",{className:"text-sm font-medium text-gray-700 mb-3",children:"Cases"}),P.map(e=>{var t,s;return(0,p.jsx)("div",{className:"relative p-3 rounded-md mb-2 "+(E===e.id?"bg-[#E5F4F1] border border-[#5EB47C]":"bg-gray-50 hover:bg-gray-100"),children:X===e.id?(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("input",{type:"text",value:te,onChange:e=>se(e.target.value),onKeyDown:e=>{"Enter"===e.key&&et(),"Escape"===e.key&&tt()},className:"flex-1 text-sm font-medium bg-white border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-[#3B82F6] focus:border-transparent",autoFocus:!0}),(0,p.jsx)("button",{onClick:et,className:"p-1 text-green-600 hover:text-green-800",title:"Save",children:(0,p.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,p.jsx)("button",{onClick:tt,className:"p-1 text-gray-400 hover:text-gray-600",title:"Cancel",children:(0,p.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}):(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{onClick:()=>(async e=>{const t=P.find(t=>t.id===e);var s;t&&(I(e),w(t.messages),A(t.locked),null!==(s=t.healthReport)&&void 0!==s&&s.analysis?(Ce(t.healthReport.analysis),Pe(t.healthReport.severity||"Moderate")):t.analysis?(Ce(t.analysis),Pe("Moderate")):(Ce({criteria:{emergencyScreening:!1,petSpecies:!1,petAge:!1,mainSymptoms:!1,durationSymptoms:!1,eatingDrinking:!1,behavioralChanges:!1,lifestyleFactors:!1,preventativeCare:!1,medicalHistory:!1},completedCriteria:0,progressPercentage:0,stage:"Getting Started",emergencyDetected:!1,medicalHistory:!1}),Pe("Moderate")))})(e.id),className:"cursor-pointer",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsx)("span",{className:"text-sm font-medium",children:e.title}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[e.locked&&(0,p.jsx)("span",{className:"text-xs text-green-600",children:"\ud83d\udd12 Complete"}),(0,p.jsxs)("div",{className:"relative",ref:t=>Be.current[e.id]=t,children:[(0,p.jsx)("button",{onClick:t=>{t.stopPropagation(),J(Y===e.id?null:e.id)},className:"p-1 rounded-md text-gray-400 hover:text-gray-600 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#3B82F6]",title:"More options",children:(0,p.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"})})}),Y===e.id&&(0,p.jsxs)("div",{className:"fixed bg-white border border-gray-200 rounded-md shadow-xl ring-1 ring-black ring-opacity-5 z-[200] w-32","data-dropdown-id":e.id,style:{top:`${(null===(t=Be.current[e.id])||void 0===t?void 0:t.getBoundingClientRect().bottom)+4}px`,left:(null===(s=Be.current[e.id])||void 0===s?void 0:s.getBoundingClientRect().right)-128+"px"},children:[(0,p.jsxs)("button",{onClick:t=>{t.stopPropagation(),(e=>{const t=P.find(t=>t.id===e);t&&(ee(e),se(t.title),J(null))})(e.id)},className:"w-full px-3 py-2 text-left text-sm text-gray-700 hover:bg-gray-50 flex items-center space-x-2 rounded-t-md",children:[(0,p.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})}),(0,p.jsx)("span",{children:"Rename"})]}),(0,p.jsxs)("button",{onClick:t=>{var s;t.stopPropagation(),s=e.id,window.confirm("Are you sure you want to delete this case? This action cannot be undone.")&&(M(e=>e.filter(e=>e.id!==s)),E===s&&(I(null),w([]),A(!1),Ce({criteria:{emergencyScreening:!1,petSpecies:!1,petAge:!1,mainSymptoms:!1,durationSymptoms:!1,eatingDrinking:!1,behavioralChanges:!1,lifestyleFactors:!1,preventativeCare:!1,medicalHistory:!1},stage:"Initial Assessment",progressPercentage:0}),Pe(null))),J(null)},className:"w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center space-x-2 border-t border-gray-100 rounded-b-md",children:[(0,p.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),(0,p.jsx)("span",{children:"Delete"})]})]})]})]})]}),(0,p.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(e.createdAt).toLocaleDateString()})]})})},e.id)})]})})]}),(0,p.jsxs)("div",{className:"flex-1 flex flex-col min-w-0",children:[(0,p.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("button",{onClick:()=>U(!_),className:"md:hidden mr-3 p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500",children:(0,p.jsx)("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,p.jsxs)("div",{className:"relative",ref:Fe,children:[(0,p.jsx)("button",{onClick:()=>Q(!K),className:"text-left hover:bg-gray-50 p-1 rounded transition-colors",children:(0,p.jsxs)("h1",{className:"text-base font-semibold text-gray-800 flex items-center",children:["LuniGen 3",(0,p.jsx)("svg",{className:"ml-1 w-3 h-3 transition-transform "+(K?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})}),K&&(0,p.jsxs)("div",{className:"absolute top-full left-0 mt-1 bg-white border border-gray-200 rounded-md shadow-lg z-50 min-w-[200px]",children:[(0,p.jsxs)("button",{onClick:()=>{Q(!1)},className:"w-full p-3 text-left hover:bg-gray-50 border-b border-gray-100",children:[(0,p.jsx)("div",{className:"font-medium text-gray-900",children:"LuniGen 3"}),(0,p.jsx)("div",{className:"text-xs text-green-600 font-medium",children:"Current"})]}),(0,p.jsxs)("button",{disabled:!0,className:"w-full p-3 text-left bg-gray-50 cursor-not-allowed opacity-60",children:[(0,p.jsx)("div",{className:"font-medium text-gray-500",children:"LuniGen 4"}),(0,p.jsx)("div",{className:"text-xs text-gray-400",children:"coming soon"})]})]})]})]}),(0,p.jsxs)("div",{className:"hidden md:flex items-center space-x-3",children:[!C&&ke&&(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,p.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(ke.progressPercentage>=100?"bg-green-500":ke.progressPercentage>=90?"bg-green-400":ke.progressPercentage>=75?"bg-blue-500":ke.progressPercentage>=55?"bg-yellow-500":ke.progressPercentage>=35?"bg-orange-400":"bg-gray-400"),style:{width:`${ke.progressPercentage}%`}})}),(0,p.jsxs)("span",{className:"text-xs text-gray-600",children:[ke.stage," (",ke.progressPercentage,"%)"]})]}),Ie&&(0,p.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium "+("Emergency"===Ie?"bg-amber-100 text-amber-800":"Serious"===Ie?"bg-orange-100 text-orange-800":"Moderate"===Ie?"bg-yellow-100 text-yellow-800":"Mild"===Ie?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"Moderate"!==Ie||C?Ie:"Assessing..."}),C&&(0,p.jsx)("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Assessment Complete"})]})]}),(0,p.jsxs)("div",{className:"md:hidden mt-3 flex items-center justify-between",children:[!C&&ke&&(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,p.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 "+(ke.progressPercentage>=100?"bg-green-500":ke.progressPercentage>=90?"bg-green-400":ke.progressPercentage>=75?"bg-blue-500":ke.progressPercentage>=55?"bg-yellow-500":ke.progressPercentage>=35?"bg-orange-400":"bg-gray-400"),style:{width:`${ke.progressPercentage}%`}})}),(0,p.jsxs)("span",{className:"text-xs text-gray-600",children:[ke.stage," (",ke.progressPercentage,"%)"]})]}),Ie&&(0,p.jsx)("div",{className:"px-3 py-1 rounded-full text-sm font-medium "+("Emergency"===Ie?"bg-amber-100 text-amber-800":"Serious"===Ie?"bg-orange-100 text-orange-800":"Moderate"===Ie?"bg-yellow-100 text-yellow-800":"Mild"===Ie?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:"Moderate"!==Ie||C?Ie:"Assessing..."}),C&&(0,p.jsx)("div",{className:"bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm",children:"Assessment Complete"})]})]}),(0,p.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[f.map(e=>(0,p.jsx)("div",{className:"flex "+("user"===e.type?"justify-end":"justify-start"),children:(0,p.jsxs)("div",{className:"max-w-3xl p-4 rounded-lg "+("user"===e.type?"bg-[#5EB47C] text-white":"soap"===e.type?"bg-yellow-50 border border-yellow-200 text-gray-800":"image"===e.type?"bg-[#fef7f0] border border-[#F88C50] text-gray-800":e.isError?"bg-red-50 border border-red-200 text-red-800":"bg-white border border-gray-200 text-gray-800"),children:["soap"===e.type&&(0,p.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:"text-yellow-600 mr-2",children:"\ud83e\ude7a"}),(0,p.jsx)("span",{className:"font-semibold text-yellow-800",children:"HEALTH REPORT"})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[e.severity&&(0,p.jsx)("div",{className:"px-2 py-1 rounded text-xs font-medium "+("Emergency"===e.severity?"bg-amber-200 text-amber-800":"Serious"===e.severity?"bg-orange-200 text-orange-800":"Moderate"===e.severity?"bg-yellow-200 text-yellow-800":"Mild"===e.severity?"bg-green-200 text-green-800":"bg-gray-200 text-gray-800"),children:e.severity}),(0,p.jsxs)("button",{onClick:()=>qe(e.content),className:"flex items-center px-2 py-1 text-xs bg-blue-100 hover:bg-blue-200 text-blue-700 rounded transition-colors duration-200",title:"Copy Pet Health Summary to clipboard",children:[(0,p.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy"]}),re&&!e.isError&&(0,p.jsxs)("button",{onClick:()=>function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"soap";re?0!==ne.length?(ge(e),le(!0)):t("Please add a pet to your account first. You can do this in your Pet Owner Dashboard."):t("Please log in to save your assessment to your pet's medical history.")}("soap"),className:"flex items-center px-2 py-1 text-xs bg-green-100 hover:bg-green-200 text-green-700 rounded transition-colors duration-200",title:"Save Health Report to pet medical history",children:[(0,p.jsx)("svg",{className:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Save"]})]})]}),"image"===e.type&&(0,p.jsxs)("div",{className:"flex items-center mb-3",children:[(0,p.jsx)("span",{className:"text-[#F88C50] mr-2",children:"\ud83d\udcf7"}),(0,p.jsxs)("span",{className:"font-semibold text-[#e06b1a]",children:["Image Analysis: ",e.fileName]}),e.streaming&&(0,p.jsxs)("div",{className:"flex items-center ml-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-[#e06b1a]"}),(0,p.jsx)("span",{className:"text-xs text-[#e06b1a] ml-1",children:"analyzing..."})]})]}),"image"===e.type&&e.image&&(0,p.jsx)("div",{className:"mb-3",children:(0,p.jsx)("img",{src:e.image,alt:e.fileName,className:"max-w-full h-auto rounded-lg border border-gray-300 max-h-64 object-contain"})}),e.isStreaming&&0===e.content.length?(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 "+("soap"===e.type?"border-yellow-600":"border-[#5EB47C]")}),(0,p.jsx)("span",{className:"text-sm text-gray-500",children:"soap"===e.type?"Generating Health Report...":"Luni is thinking..."})]}):(0,p.jsx)("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:b(e)}}),e.isStreaming&&e.content.length>0&&(0,p.jsx)("div",{className:"inline-flex items-center ml-1",children:(0,p.jsx)("div",{className:"w-1 h-4 bg-gray-400 animate-pulse"})}),(0,p.jsx)("div",{className:"text-xs mt-2 "+("user"===e.type?"text-green-200":"text-gray-500"),children:new Date(e.timestamp).toLocaleTimeString()})]})},e.id)),S&&!f.some(e=>e.isStreaming)&&(0,p.jsx)("div",{className:"flex justify-start",children:(0,p.jsx)("div",{className:"bg-white border border-gray-200 p-4 rounded-lg",children:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#5EB47C]"}),(0,p.jsx)("span",{className:"text-gray-600",children:"Luni is thinking..."})]})})}),G&&(0,p.jsx)("div",{className:"flex justify-start",children:(0,p.jsx)("div",{className:"bg-white border border-gray-200 p-4 rounded-lg",children:(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-[#F88C50]"}),(0,p.jsx)("span",{className:"text-gray-600",children:"Analyzing image..."})]})})}),(0,p.jsx)("div",{ref:He})]}),(0,p.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:C?(0,p.jsxs)("div",{className:"text-center py-4",children:[(0,p.jsx)("p",{className:"text-gray-600 mb-2",children:"This assessment is complete and the chat is locked."}),(0,p.jsx)("p",{className:"text-sm text-gray-500",children:"Start a new case or upgrade to additional services using the sidebar options."})]}):(0,p.jsxs)("div",{className:"space-y-3 relative z-10",children:[(0,p.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,p.jsxs)("div",{className:"flex-1 relative",children:[(0,p.jsx)("textarea",{value:j,onChange:e=>N(e.target.value),onKeyPress:e=>"Enter"===e.key&&!e.shiftKey&&st(),placeholder:C&&"AI Service Unavailable"===Ie?"Chat unavailable - AI service error. Please try again later.":C?"Assessment complete":"Describe your pet's symptoms...",className:"w-full p-3 pr-12 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#3B82F6] resize-none min-h-[44px] max-h-32",disabled:S||G||C,rows:"1",style:{height:"auto",minHeight:"44px"},onInput:e=>{e.target.style.height="auto",e.target.style.height=Math.min(e.target.scrollHeight,128)+"px"}}),(0,p.jsx)("button",{onClick:()=>{var e;return null===(e=Te.current)||void 0===e?void 0:e.click()},disabled:S||G,className:"absolute right-2.5 top-2.5 text-gray-400 hover:text-gray-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",title:"Upload image for analysis",children:(0,p.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})})]}),(0,p.jsx)("button",{onClick:st,disabled:S||G||!j.trim()||C,className:"bg-[#5EB47C] text-white p-3 rounded-lg hover:bg-[#4A9A64] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center transition-colors min-h-[44px] self-start",title:C&&"AI Service Unavailable"===Ie?"Chat unavailable - AI service error":"Send message",children:(0,p.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]}),(0,p.jsx)("input",{ref:Te,type:"file",accept:"image/*",multiple:!0,onChange:async e=>{const t=Array.from(e.target.files);if(0!==t.length){W(!0);try{for(const e of t){const t=await Ke(e),r={id:(0,a.v4)(),type:"image",content:"Analyzing image...",image:t,fileName:e.name,timestamp:(new Date).toISOString(),streaming:!0},n=[...f,r];w(n),We(n);const i=(e,t)=>{w(e=>e.map(e=>e.id===r.id?{...e,content:t,streaming:!0}:e))};try{const s=await Qe(t,e.name,i),a=n.map(e=>e.id===r.id?{...e,content:s,streaming:!1}:e);w(a),We(a);const o={id:r.id,file:e,base64:t,analysis:s,timestamp:(new Date).toISOString()};V(e=>[...e,o]),await Xe(a)}catch(s){console.error("Error analyzing individual image:",s),w(e=>e.map(e=>e.id===r.id?{...e,content:"Error analyzing image. Please try again or describe what you see.",streaming:!1}:e))}}}catch(r){console.error("Error analyzing image:",r);const e={id:(0,a.v4)(),type:"ai",content:"I apologize, but I encountered an error analyzing the image. Please try again or describe what you see in the image.",timestamp:(new Date).toISOString()};w(t=>[...t,e])}finally{W(!1),Te.current&&(Te.current.value="")}}},className:"hidden"})]})})]}),R&&(0,p.jsx)(ct,{}),Me&&(0,p.jsx)("div",{className:"fixed inset-0 bg-amber-900 bg-opacity-70 flex items-center justify-center z-[60] p-4",children:(0,p.jsx)("div",{className:"bg-white rounded-2xl max-w-lg w-full mx-4 relative shadow-2xl border-4 border-amber-400",children:(0,p.jsxs)("div",{className:"p-6",children:[(0,p.jsx)("div",{className:"flex justify-center mb-4",children:(0,p.jsx)("div",{className:"w-16 h-16 bg-amber-100 rounded-full flex items-center justify-center",children:(0,p.jsx)("svg",{className:"w-8 h-8 text-amber-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 18.5c-.77.833.192 2.5 1.732 2.5z"})})})}),(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)("h2",{className:"text-2xl font-bold text-amber-700 mb-3",children:"\u26a0\ufe0f URGENT ATTENTION NEEDED"}),(0,p.jsxs)("p",{className:"text-gray-700 mb-4",children:["Based on the symptoms you've described, your pet may need ",(0,p.jsx)("strong",{children:"immediate veterinary attention"}),"."]}),(0,p.jsxs)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4 mb-6",children:[(0,p.jsx)("h3",{className:"font-semibold text-amber-800 mb-2",children:"IMMEDIATE ACTIONS:"}),(0,p.jsxs)("ul",{className:"text-sm text-amber-700 text-left space-y-1",children:[(0,p.jsx)("li",{children:"\u2022 Contact your veterinarian or emergency clinic NOW"}),(0,p.jsx)("li",{children:"\u2022 Do not wait for symptoms to worsen"}),(0,p.jsx)("li",{children:"\u2022 Keep your pet calm and comfortable"}),(0,p.jsx)("li",{children:"\u2022 Prepare for immediate transport if needed"})]})]}),(0,p.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Would you like to continue with the assessment to complete the medical note for your vet?"}),(0,p.jsxs)("div",{className:"flex space-x-3",children:[(0,p.jsx)("button",{onClick:()=>{Le(!1)},className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg font-medium transition-colors",children:"Continue Assessment"}),(0,p.jsx)("button",{onClick:()=>{Le(!1)},className:"flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-3 rounded-lg font-medium transition-colors",children:"Close"})]})]})]})})}),oe&&(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,p.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"\ud83d\udcbe Save to Medical History"}),(0,p.jsxs)("p",{className:"text-gray-600 mb-4",children:["Save this ","soap"===me?"Health Report":"case assessment"," to your pet's medical history for future reference."]}),(0,p.jsxs)("div",{className:"mb-4",children:[(0,p.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Pet:"}),(0,p.jsxs)("select",{value:ce||"",onChange:e=>de(e.target.value),className:"w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-[#3B82F6] focus:border-[#3B82F6]",children:[(0,p.jsx)("option",{value:"",children:"Choose a pet..."}),ne.map(e=>(0,p.jsxs)("option",{value:e.id,children:["dog"===e.species?"\ud83d\udc15":"cat"===e.species?"\ud83d\udc31":"\ud83d\udc3e"," ",e.name," (",e.breed||e.species,")"]},e.id))]})]}),0===ne.length&&(0,p.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,p.jsxs)("p",{className:"text-blue-800 text-sm",children:["You don't have any pets added to your account yet.",(0,p.jsx)("a",{href:"/pets",className:"underline hover:text-blue-900 ml-1",children:"Add a pet first"})]})}),(0,p.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,p.jsx)("button",{onClick:()=>le(!1),disabled:ue,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Cancel"}),(0,p.jsx)("button",{onClick:async()=>{if(ce)if("soap"===me){const s=f.find(e=>"soap"===e.type&&!e.isError);if(!s)return void t("No Health Report found to save. Please complete the assessment first.");await(async(s,r)=>{try{he(!0),console.log("=== LUNI TRIAGE SOAP SAVE DEBUG ==="),console.log("Pet ID:",s),console.log("User ID:",re.id),console.log("Health Report Message:",r),console.log("Current Chat ID:",E);const a=d.A.parseLuniSoapContent(r.content);console.log("Parsed SOAP:",a);const n={...a,title:`Luni Triage Assessment - ${(new Date).toLocaleDateString()}`,source:"luni_triage",luni_chat_id:E,severity:r.severity||Ie,visit_date:(new Date).toISOString()};console.log("Final SOAP Data:",n);const i=await d.A.addHealthReport(s,re.id,n);console.log("Save result:",i),i.success?(e("Health Report saved to your pet's medical history! View it in your Pet Owner Dashboard."),le(!1)):(console.error("Save failed:",i.error),t(`Failed to save Health Report: ${i.error}`))}catch(a){console.error("Error saving Health Report:",a),console.error("Error stack:",a.stack),t("Failed to save Health Report. Please try again.")}finally{he(!1)}})(ce,s)}else await(async s=>{try{he(!0);const r=[];f.filter(e=>"user"===e.type).forEach(e=>{e.content&&!e.content.startsWith("data:image")&&r.push(e.content)});const a={entry_type:"luni_triage",title:`Luni Triage Case - ${(new Date).toLocaleDateString()}`,description:`Triage assessment conducted through Luni AI. Severity: ${Ie}`,symptoms:r,assessment:ke.summary||"AI triage assessment completed",treatment_plan:ke.recommendations||"See Pet Health Summary for detailed recommendations",severity:Ie.toLowerCase(),notes:`Luni Triage Chat ID: ${E}`,attachments:[]},n=await d.A.addCaseEntry(s,re.id,a);n.success?(e("Case entry saved to your pet's medical history! View it in your Pet Owner Dashboard."),le(!1)):t(`Failed to save case entry: ${n.error}`)}catch(r){console.error("Error saving case entry:",r),t("Failed to save case entry. Please try again.")}finally{he(!1)}})(ce);else t("Please select a pet to save this assessment for.")},disabled:ue||!ce,className:"px-4 py-2 bg-[#3B82F6] text-white rounded-lg hover:bg-[#2563EB] disabled:opacity-50 flex items-center",children:ue?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,p.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Save to History"]})})]})]})}),we&&(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,p.jsxs)("div",{className:"bg-white rounded-xl p-6 max-w-md w-full mx-4",children:[(0,p.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"Select Pet for Triage Assessment"}),(0,p.jsx)("p",{className:"text-gray-600 mb-4",children:"Choose which pet you're seeking triage for. Their medical history will be automatically included in the assessment."}),(0,p.jsxs)("div",{className:"space-y-3 max-h-64 overflow-y-auto",children:[ne.map(e=>(0,p.jsx)("button",{onClick:()=>Ye(e),className:"w-full p-3 border border-gray-200 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors text-left",children:(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:"text-2xl mr-3",children:"dog"===e.species?"\ud83d\udc15":"cat"===e.species?"\ud83d\udc31":"bird"===e.species?"\ud83d\udc26":"rabbit"===e.species?"\ud83d\udc30":"\ud83d\udc3e"}),(0,p.jsxs)("div",{className:"flex-1",children:[(0,p.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,p.jsxs)("p",{className:"text-sm text-gray-600",children:[e.species," \u2022 ",e.breed||"Mixed"," \u2022 ",e.weight||"Unknown weight"]}),e.allergies&&(0,p.jsxs)("p",{className:"text-xs text-orange-600 mt-1",children:["\u26a0\ufe0f Allergies: ",e.allergies]})]})]})},e.id)),(0,p.jsx)("button",{onClick:()=>Ye(null),className:"w-full p-3 border border-gray-200 rounded-lg hover:border-gray-400 hover:bg-gray-50 transition-colors text-left",children:(0,p.jsxs)("div",{className:"flex items-center",children:[(0,p.jsx)("span",{className:"text-2xl mr-3",children:"\u274c"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"font-medium text-gray-700",children:"No specific pet"}),(0,p.jsx)("p",{className:"text-sm text-gray-500",children:"Continue without medical history"})]})]})})]}),(0,p.jsx)("div",{className:"flex justify-end space-x-3 mt-6",children:(0,p.jsx)("button",{onClick:()=>je(!1),className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50",children:"Cancel"})})]})}),(0,p.jsx)(y,{})]})}}}]);
//# sourceMappingURL=895.4b96f867.chunk.js.map