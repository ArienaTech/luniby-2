"use strict";(self.webpackChunkresponsive_navbar_website=self.webpackChunkresponsive_navbar_website||[]).push([[340],{340:(e,t,s)=>{s.r(t),s.d(t,{default:()=>d});var a=s(5043),r=s(1740),l=s(579);const d=()=>{const[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)([]),[c,i]=(0,a.useState)(null),[n,x]=(0,a.useState)(!0);(0,a.useEffect)(()=>{o()},[]);const o=async()=>{try{const{data:{user:e},error:s}=await r.N.auth.getUser();if(s||!e)return console.log("No user found"),void x(!1);i(e);const{data:a,error:l}=await r.N.from("pets").select("*").eq("owner_id",e.id).order("created_at",{ascending:!1});l?console.error("Error loading pets:",l):t(a||[]);const{data:c,error:n}=await r.N.from("health_records").select("*").order("created_at",{ascending:!1}).limit(10);n?console.error("Error loading health records:",n):d(c||[])}catch(e){console.error("Error loading diagnostic data:",e)}finally{x(!1)}};return n?(0,l.jsx)("div",{className:"p-6",children:"Loading diagnostic data..."}):c?(0,l.jsx)("div",{className:"max-w-6xl mx-auto p-6",children:(0,l.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold mb-6 text-gray-900",children:"\ud83d\udd2c Pets & Health Records Diagnostic"}),(0,l.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 rounded-lg",children:[(0,l.jsx)("h3",{className:"font-semibold text-blue-900 mb-2",children:"Current User"}),(0,l.jsxs)("p",{className:"text-blue-700",children:["Email: ",c.email]}),(0,l.jsxs)("p",{className:"text-blue-700",children:["ID: ",c.id]})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Your Pets (",e.length,")"]}),(0,l.jsx)("button",{onClick:o,className:"bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700",children:"Refresh"})]}),0===e.length?(0,l.jsx)("div",{className:"p-4 bg-yellow-50 rounded-lg",children:(0,l.jsx)("p",{className:"text-yellow-800",children:"No pets found. This might be the issue!"})}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Name"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Species"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Owner ID"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Created"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Test"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-gray-200",children:e.map(e=>(0,l.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,l.jsx)("td",{className:"px-4 py-2 text-sm font-mono text-gray-900",children:e.id}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.name}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:e.species}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm font-mono text-gray-500",children:e.owner_id}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-500",children:new Date(e.created_at).toLocaleDateString()}),(0,l.jsx)("td",{className:"px-4 py-2",children:(0,l.jsx)("button",{onClick:()=>(async e=>{try{console.log("Testing health record creation for pet:",e);const t={record_type:"checkup",title:"Test Health Record",description:"This is a test record",date_performed:(new Date).toISOString().split("T")[0],notes:"Test notes"},{data:s,error:a}=await r.N.from("health_records").insert([{pet_id:e,...t,created_at:(new Date).toISOString()}]).select().single();a?(alert(`\u274c Test failed: ${a.message}`),console.error("Test error:",a)):(alert("\u2705 Test successful! Health record created."),console.log("Test success:",s),o())}catch(t){alert(`\u274c Exception: ${t.message}`),console.error("Test exception:",t)}})(e.id),className:"bg-green-600 text-white px-2 py-1 rounded text-xs hover:bg-green-700",children:"Test Health Record"})})]},e.id))})]})})]}),(0,l.jsxs)("div",{className:"mb-8",children:[(0,l.jsxs)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Recent Health Records (",s.length,")"]}),0===s.length?(0,l.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg",children:(0,l.jsx)("p",{className:"text-gray-600",children:"No health records found."})}):(0,l.jsx)("div",{className:"overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full bg-white border border-gray-200 rounded-lg",children:[(0,l.jsx)("thead",{className:"bg-gray-50",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Pet ID"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Title"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Type"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),(0,l.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase",children:"Created"})]})}),(0,l.jsx)("tbody",{className:"divide-y divide-gray-200",children:s.map(t=>{const s=e.find(e=>e.id===t.pet_id);return(0,l.jsxs)("tr",{className:"hover:bg-gray-50 "+(s?"":"bg-red-50"),children:[(0,l.jsx)("td",{className:"px-4 py-2 text-sm font-mono text-gray-900",children:t.id}),(0,l.jsxs)("td",{className:"px-4 py-2 text-sm font-mono text-gray-900",children:[t.pet_id,!s&&(0,l.jsx)("span",{className:"text-red-600 ml-2",children:"\u274c"})]}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.title}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-900",children:t.record_type}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-500",children:t.date_performed?new Date(t.date_performed).toLocaleDateString():"N/A"}),(0,l.jsx)("td",{className:"px-4 py-2 text-sm text-gray-500",children:new Date(t.created_at).toLocaleDateString()})]},t.id)})})]})})]}),(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,l.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Diagnostic Info"}),(0,l.jsxs)("ul",{className:"text-sm text-gray-700 space-y-1",children:[(0,l.jsxs)("li",{children:["\u2022 Total pets found: ",e.length]}),(0,l.jsxs)("li",{children:["\u2022 Total health records: ",s.length]}),(0,l.jsxs)("li",{children:["\u2022 Orphaned health records: ",s.filter(t=>!e.find(e=>e.id===t.pet_id)).length]}),(0,l.jsxs)("li",{children:["\u2022 User ID: ",c.id]})]})]}),(0,l.jsxs)("div",{className:"mt-6 p-4 bg-blue-50 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-semibold text-blue-900 mb-2",children:"Troubleshooting Steps:"}),(0,l.jsxs)("ol",{className:"text-sm text-blue-700 space-y-1 list-decimal list-inside",children:[(0,l.jsx)("li",{children:"Check if you have any pets in the table above"}),(0,l.jsx)("li",{children:"If no pets, create a pet first in the dashboard"}),(0,l.jsx)("li",{children:'Use the "Test Health Record" button to verify foreign key works'}),(0,l.jsx)("li",{children:"Check browser console for detailed error messages"}),(0,l.jsx)("li",{children:"Refresh this page after creating/updating pets"})]})]})]})}):(0,l.jsx)("div",{className:"p-6",children:"Please sign in to run diagnostics."})}}}]);
//# sourceMappingURL=340.1e8a2803.chunk.js.map