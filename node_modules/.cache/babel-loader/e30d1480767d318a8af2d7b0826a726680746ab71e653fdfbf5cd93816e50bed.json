{"ast":null,"code":"import React,{useState,useEffect,useContext,createContext}from'react';import{supabase}from'../lib/supabase';import{subscribeToAuth}from'../lib/auth-manager.js';import favoritesService from'../services/favoritesService';import{useNavigate}from'react-router-dom';import{initializeFavorites}from'../utils/initializeFavorites';// Create a context to manage favorites globally and avoid N+1 queries\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const FavoritesContext=/*#__PURE__*/createContext();// Favorites Provider Component\nexport const FavoritesProvider=_ref=>{let{children}=_ref;const[favorites,setFavorites]=useState(new Set());const[user,setUser]=useState(null);const[isLoading,setIsLoading]=useState(true);useEffect(()=>{loadUserAndFavorites();// Use centralized auth manager\nconst unsubscribe=subscribeToAuth(async(event,session)=>{var _session$user;console.log('üîÑ Auth state changed:',event,session===null||session===void 0?void 0:(_session$user=session.user)===null||_session$user===void 0?void 0:_session$user.email);if(event==='SIGNED_IN'||event==='TOKEN_REFRESHED'||event==='INITIAL_SESSION'){setUser((session===null||session===void 0?void 0:session.user)||null);if(session!==null&&session!==void 0&&session.user){const result=await favoritesService.getUserFavorites(session.user.id);if(result.success){const favoriteKeys=new Set(result.data.map(fav=>`${fav.listing_type}-${fav.listing_id}`));setFavorites(favoriteKeys);}}}else if(event==='SIGNED_OUT'){setUser(null);setFavorites(new Set());}setIsLoading(false);});return unsubscribe;},[]);const loadUserAndFavorites=async()=>{try{console.log('üîÑ Loading user and favorites...');// First, try to initialize the favorites system\nconst initResult=await initializeFavorites();if(!initResult.success&&initResult.needsSetup){console.warn('‚ö†Ô∏è Favorites system needs database setup');}const{data:{user},error:userError}=await supabase.auth.getUser();if(userError){var _userError$message;// Handle auth session missing gracefully\nif((_userError$message=userError.message)!==null&&_userError$message!==void 0&&_userError$message.includes('Auth session missing')){console.log('‚ÑπÔ∏è No auth session - user not logged in');}else{console.error('‚ùå Error getting user:',userError);}setUser(null);setIsLoading(false);return;}setUser(user);console.log('üë§ User loaded:',user?user.email:'No user');if(user){console.log('üìã Loading favorites for user:',user.id);const result=await favoritesService.getUserFavorites(user.id);if(result.success){const favoriteKeys=new Set(result.data.map(fav=>`${fav.listing_type}-${fav.listing_id}`));setFavorites(favoriteKeys);console.log('‚úÖ Loaded favorites:',favoriteKeys.size,'items');}else{console.error('‚ùå Error loading favorites:',result.error);// If the table doesn't exist, we'll still continue but log the error\nif(result.error.includes('relation \"user_favorites\" does not exist')){console.warn('‚ö†Ô∏è user_favorites table does not exist - favorites will not work until table is created');}}}else{setFavorites(new Set());}}catch(error){console.error('‚ùå Error loading user favorites:',error);}finally{setIsLoading(false);}};const toggleFavorite=async(listingId,listingType)=>{if(!user)return{success:false,error:'User not authenticated'};const favoriteKey=`${listingType}-${listingId}`;const isFavorited=favorites.has(favoriteKey);// Optimistic update\nconst newFavorites=new Set(favorites);if(isFavorited){newFavorites.delete(favoriteKey);}else{newFavorites.add(favoriteKey);}setFavorites(newFavorites);try{console.log('üîÑ Toggling favorite:',{listingId,listingType,isFavorited});const result=await favoritesService.toggleFavorite(user.id,listingId,listingType);if(!result.success){console.error('‚ùå Failed to toggle favorite:',result.error);// Revert optimistic update on error\nsetFavorites(favorites);return result;}console.log('‚úÖ Successfully toggled favorite');return result;}catch(error){console.error('‚ùå Error in toggleFavorite:',error);// Revert optimistic update on error\nsetFavorites(favorites);return{success:false,error:error.message};}};const isFavorite=(listingId,listingType)=>{return favorites.has(`${listingType}-${listingId}`);};return/*#__PURE__*/_jsx(FavoritesContext.Provider,{value:{user,favorites,isLoading,toggleFavorite,isFavorite,refreshFavorites:loadUserAndFavorites},children:children});};// Custom hook to use favorites context\nexport const useFavorites=()=>{const context=useContext(FavoritesContext);if(!context){throw new Error('useFavorites must be used within a FavoritesProvider');}return context;};const FavoriteButton=_ref2=>{let{listingId,listingType,className='',size='md',showTooltip=true,onToggle=null}=_ref2;const[isLoading,setIsLoading]=useState(false);const[isHovered,setIsHovered]=useState(false);const[isAnimating,setIsAnimating]=useState(false);const navigate=useNavigate();// Use favorites context instead of individual API calls\nconst{user,isFavorite,toggleFavorite:contextToggleFavorite}=useFavorites();const isFavorited=isFavorite(listingId,listingType);// Size variants - Airbnb style with larger touch targets\nconst sizeClasses={sm:'w-8 h-8',md:'w-10 h-10',lg:'w-12 h-12'};const iconSizes={sm:'w-4 h-4',md:'w-5 h-5',lg:'w-6 h-6'};const handleToggleFavorite=async e=>{e.preventDefault();// Prevent navigation if button is inside a link\ne.stopPropagation();// Prevent event bubbling\nconsole.log('üíñ Heart icon clicked!',{listingId,listingType,user:!!user,isFavorited});if(!user){console.log('üë§ No user logged in, redirecting to signin');navigate('/signin');return;}if(isLoading){console.log('‚è≥ Already loading, ignoring click');return;}setIsLoading(true);setIsAnimating(true);try{console.log('üîÑ Calling contextToggleFavorite...');const result=await contextToggleFavorite(listingId,listingType);if(result.success){console.log('‚úÖ Favorite toggled successfully');// Call onToggle callback if provided\nif(onToggle){onToggle(!isFavorited,listingId,listingType);}// Show success feedback\nconst action=isFavorited?'Removed from favorites':'Added to favorites';console.log('üíñ',action);// Reset animation state after animation completes\nsetTimeout(()=>setIsAnimating(false),600);}else{setIsAnimating(false);console.error('‚ùå Error toggling favorite:',result.error);// Show user-friendly error message\nif(result.error.includes('relation \"user_favorites\" does not exist')){console.error('üíî Favorites table does not exist in database');}}}catch(error){setIsAnimating(false);console.error('‚ùå Error toggling favorite:',error);}finally{setIsLoading(false);}};// Don't render if missing required props\nif(!listingId||!listingType){return null;}return/*#__PURE__*/_jsx(\"button\",{onClick:handleToggleFavorite,disabled:isLoading,onMouseEnter:()=>setIsHovered(true),onMouseLeave:()=>setIsHovered(false),className:`\n        ${sizeClasses[size]} \n        rounded-full \n        flex items-center justify-center\n        transition-all duration-300 ease-out\n        transform\n        ${isHovered?'scale-110':'scale-100'}\n        focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50\n        ${!user?'bg-white/70 backdrop-blur-sm hover:bg-white/90 shadow-md hover:shadow-lg':isFavorited?'bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl':'bg-white/80 backdrop-blur-sm hover:bg-white/95 shadow-md hover:shadow-lg'}\n        ${isLoading?'opacity-50 cursor-not-allowed':'cursor-pointer'}\n        ${isAnimating&&isFavorited&&user?'favorite-glow':''}\n        border border-white/20\n        group\n        ${className}\n      `,title:showTooltip?!user?'Sign in to add to favorites':isFavorited?'Remove from favorites':'Add to favorites':'',\"aria-label\":!user?'Sign in to add to favorites':isFavorited?'Remove from favorites':'Add to favorites',children:isLoading?/*#__PURE__*/_jsx(\"div\",{className:`${iconSizes[size]} animate-spin`,children:/*#__PURE__*/_jsxs(\"svg\",{className:\"w-full h-full text-red-400\",fill:\"none\",viewBox:\"0 0 24 24\",children:[/*#__PURE__*/_jsx(\"circle\",{className:\"opacity-25\",cx:\"12\",cy:\"12\",r:\"10\",stroke:\"currentColor\",strokeWidth:\"4\"}),/*#__PURE__*/_jsx(\"path\",{className:\"opacity-75\",fill:\"currentColor\",d:\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[/*#__PURE__*/_jsx(\"svg\",{className:`\n              ${iconSizes[size]} \n              transition-all duration-300 ease-out\n              ${!user?isHovered?'text-gray-500 scale-105':'text-gray-400':isFavorited?'text-red-500 scale-110':isHovered?'text-red-400 scale-105':'text-gray-600'}\n              ${isAnimating&&user?'heart-pop':''}\n              ${isFavorited&&isHovered&&user?'heart-beat':''}\n            `,fill:user&&isFavorited?'currentColor':'none',stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:user&&isFavorited?\"0\":\"2\",d:\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"})}),user&&isFavorited&&/*#__PURE__*/_jsx(\"div\",{className:\"absolute inset-0 rounded-full\",children:/*#__PURE__*/_jsx(\"svg\",{className:`${iconSizes[size]} text-red-500 animate-ping opacity-30`,fill:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{d:\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"})})})]})});};export default FavoriteButton;","map":{"version":3,"names":["React","useState","useEffect","useContext","createContext","supabase","subscribeToAuth","favoritesService","useNavigate","initializeFavorites","jsx","_jsx","jsxs","_jsxs","FavoritesContext","FavoritesProvider","_ref","children","favorites","setFavorites","Set","user","setUser","isLoading","setIsLoading","loadUserAndFavorites","unsubscribe","event","session","_session$user","console","log","email","result","getUserFavorites","id","success","favoriteKeys","data","map","fav","listing_type","listing_id","initResult","needsSetup","warn","error","userError","auth","getUser","_userError$message","message","includes","size","toggleFavorite","listingId","listingType","favoriteKey","isFavorited","has","newFavorites","delete","add","isFavorite","Provider","value","refreshFavorites","useFavorites","context","Error","FavoriteButton","_ref2","className","showTooltip","onToggle","isHovered","setIsHovered","isAnimating","setIsAnimating","navigate","contextToggleFavorite","sizeClasses","sm","md","lg","iconSizes","handleToggleFavorite","e","preventDefault","stopPropagation","action","setTimeout","onClick","disabled","onMouseEnter","onMouseLeave","title","fill","viewBox","cx","cy","r","stroke","strokeWidth","d","strokeLinecap","strokeLinejoin"],"sources":["/workspace/src/components/FavoriteButton.js"],"sourcesContent":["import React, { useState, useEffect, useContext, createContext } from 'react';\nimport { supabase } from '../lib/supabase';\nimport { subscribeToAuth } from '../lib/auth-manager.js';\nimport favoritesService from '../services/favoritesService';\nimport { useNavigate } from 'react-router-dom';\nimport { initializeFavorites } from '../utils/initializeFavorites';\n\n// Create a context to manage favorites globally and avoid N+1 queries\nconst FavoritesContext = createContext();\n\n// Favorites Provider Component\nexport const FavoritesProvider = ({ children }) => {\n  const [favorites, setFavorites] = useState(new Set());\n  const [user, setUser] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n\n  useEffect(() => {\n    loadUserAndFavorites();\n    \n    // Use centralized auth manager\n    const unsubscribe = subscribeToAuth(async (event, session) => {\n      console.log('üîÑ Auth state changed:', event, session?.user?.email);\n      \n      if (event === 'SIGNED_IN' || event === 'TOKEN_REFRESHED' || event === 'INITIAL_SESSION') {\n        setUser(session?.user || null);\n        if (session?.user) {\n          const result = await favoritesService.getUserFavorites(session.user.id);\n          if (result.success) {\n            const favoriteKeys = new Set(\n              result.data.map(fav => `${fav.listing_type}-${fav.listing_id}`)\n            );\n            setFavorites(favoriteKeys);\n          }\n        }\n      } else if (event === 'SIGNED_OUT') {\n        setUser(null);\n        setFavorites(new Set());\n      }\n      \n      setIsLoading(false);\n    });\n\n    return unsubscribe;\n  }, []);\n\n  const loadUserAndFavorites = async () => {\n    try {\n      console.log('üîÑ Loading user and favorites...');\n      \n      // First, try to initialize the favorites system\n      const initResult = await initializeFavorites();\n      if (!initResult.success && initResult.needsSetup) {\n        console.warn('‚ö†Ô∏è Favorites system needs database setup');\n      }\n      \n      const { data: { user }, error: userError } = await supabase.auth.getUser();\n      \n      if (userError) {\n        // Handle auth session missing gracefully\n        if (userError.message?.includes('Auth session missing')) {\n          console.log('‚ÑπÔ∏è No auth session - user not logged in');\n        } else {\n          console.error('‚ùå Error getting user:', userError);\n        }\n        setUser(null);\n        setIsLoading(false);\n        return;\n      }\n      \n      setUser(user);\n      console.log('üë§ User loaded:', user ? user.email : 'No user');\n      \n      if (user) {\n        console.log('üìã Loading favorites for user:', user.id);\n        const result = await favoritesService.getUserFavorites(user.id);\n        \n        if (result.success) {\n          const favoriteKeys = new Set(\n            result.data.map(fav => `${fav.listing_type}-${fav.listing_id}`)\n          );\n          setFavorites(favoriteKeys);\n          console.log('‚úÖ Loaded favorites:', favoriteKeys.size, 'items');\n        } else {\n          console.error('‚ùå Error loading favorites:', result.error);\n          // If the table doesn't exist, we'll still continue but log the error\n          if (result.error.includes('relation \"user_favorites\" does not exist')) {\n            console.warn('‚ö†Ô∏è user_favorites table does not exist - favorites will not work until table is created');\n          }\n        }\n      } else {\n        setFavorites(new Set());\n      }\n    } catch (error) {\n      console.error('‚ùå Error loading user favorites:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const toggleFavorite = async (listingId, listingType) => {\n    if (!user) return { success: false, error: 'User not authenticated' };\n\n    const favoriteKey = `${listingType}-${listingId}`;\n    const isFavorited = favorites.has(favoriteKey);\n    \n    // Optimistic update\n    const newFavorites = new Set(favorites);\n    if (isFavorited) {\n      newFavorites.delete(favoriteKey);\n    } else {\n      newFavorites.add(favoriteKey);\n    }\n    setFavorites(newFavorites);\n\n    try {\n      console.log('üîÑ Toggling favorite:', { listingId, listingType, isFavorited });\n      const result = await favoritesService.toggleFavorite(user.id, listingId, listingType);\n      \n      if (!result.success) {\n        console.error('‚ùå Failed to toggle favorite:', result.error);\n        // Revert optimistic update on error\n        setFavorites(favorites);\n        return result;\n      }\n      \n      console.log('‚úÖ Successfully toggled favorite');\n      return result;\n    } catch (error) {\n      console.error('‚ùå Error in toggleFavorite:', error);\n      // Revert optimistic update on error\n      setFavorites(favorites);\n      return { success: false, error: error.message };\n    }\n  };\n\n  const isFavorite = (listingId, listingType) => {\n    return favorites.has(`${listingType}-${listingId}`);\n  };\n\n  return (\n    <FavoritesContext.Provider value={{\n      user,\n      favorites,\n      isLoading,\n      toggleFavorite,\n      isFavorite,\n      refreshFavorites: loadUserAndFavorites\n    }}>\n      {children}\n    </FavoritesContext.Provider>\n  );\n};\n\n// Custom hook to use favorites context\nexport const useFavorites = () => {\n  const context = useContext(FavoritesContext);\n  if (!context) {\n    throw new Error('useFavorites must be used within a FavoritesProvider');\n  }\n  return context;\n};\n\nconst FavoriteButton = ({ \n  listingId, \n  listingType, \n  className = '', \n  size = 'md',\n  showTooltip = true,\n  onToggle = null \n}) => {\n  const [isLoading, setIsLoading] = useState(false);\n  const [isHovered, setIsHovered] = useState(false);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const navigate = useNavigate();\n  \n  // Use favorites context instead of individual API calls\n  const { user, isFavorite, toggleFavorite: contextToggleFavorite } = useFavorites();\n  const isFavorited = isFavorite(listingId, listingType);\n\n  // Size variants - Airbnb style with larger touch targets\n  const sizeClasses = {\n    sm: 'w-8 h-8',\n    md: 'w-10 h-10',\n    lg: 'w-12 h-12'\n  };\n\n  const iconSizes = {\n    sm: 'w-4 h-4',\n    md: 'w-5 h-5', \n    lg: 'w-6 h-6'\n  };\n\n  const handleToggleFavorite = async (e) => {\n    e.preventDefault(); // Prevent navigation if button is inside a link\n    e.stopPropagation(); // Prevent event bubbling\n    \n    console.log('üíñ Heart icon clicked!', { listingId, listingType, user: !!user, isFavorited });\n    \n    if (!user) {\n      console.log('üë§ No user logged in, redirecting to signin');\n      navigate('/signin');\n      return;\n    }\n\n    if (isLoading) {\n      console.log('‚è≥ Already loading, ignoring click');\n      return;\n    }\n\n    setIsLoading(true);\n    setIsAnimating(true);\n    \n    try {\n      console.log('üîÑ Calling contextToggleFavorite...');\n      const result = await contextToggleFavorite(listingId, listingType);\n      \n      if (result.success) {\n        console.log('‚úÖ Favorite toggled successfully');\n        \n        // Call onToggle callback if provided\n        if (onToggle) {\n          onToggle(!isFavorited, listingId, listingType);\n        }\n        \n        // Show success feedback\n        const action = isFavorited ? 'Removed from favorites' : 'Added to favorites';\n        console.log('üíñ', action);\n        \n        // Reset animation state after animation completes\n        setTimeout(() => setIsAnimating(false), 600);\n      } else {\n        setIsAnimating(false);\n        console.error('‚ùå Error toggling favorite:', result.error);\n        \n        // Show user-friendly error message\n        if (result.error.includes('relation \"user_favorites\" does not exist')) {\n          console.error('üíî Favorites table does not exist in database');\n        }\n      }\n    } catch (error) {\n      setIsAnimating(false);\n      console.error('‚ùå Error toggling favorite:', error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Don't render if missing required props\n  if (!listingId || !listingType) {\n    return null;\n  }\n\n  return (\n    <button\n      onClick={handleToggleFavorite}\n      disabled={isLoading}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n      className={`\n        ${sizeClasses[size]} \n        rounded-full \n        flex items-center justify-center\n        transition-all duration-300 ease-out\n        transform\n        ${isHovered ? 'scale-110' : 'scale-100'}\n        focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-50\n        ${!user \n          ? 'bg-white/70 backdrop-blur-sm hover:bg-white/90 shadow-md hover:shadow-lg'\n          : isFavorited \n            ? 'bg-white/95 backdrop-blur-sm hover:bg-white shadow-lg hover:shadow-xl' \n            : 'bg-white/80 backdrop-blur-sm hover:bg-white/95 shadow-md hover:shadow-lg'\n        }\n        ${isLoading ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer'}\n        ${isAnimating && isFavorited && user ? 'favorite-glow' : ''}\n        border border-white/20\n        group\n        ${className}\n      `}\n      title={showTooltip ? (!user ? 'Sign in to add to favorites' : (isFavorited ? 'Remove from favorites' : 'Add to favorites')) : ''}\n      aria-label={!user ? 'Sign in to add to favorites' : (isFavorited ? 'Remove from favorites' : 'Add to favorites')}\n    >\n      {isLoading ? (\n        <div className={`${iconSizes[size]} animate-spin`}>\n          <svg className=\"w-full h-full text-red-400\" fill=\"none\" viewBox=\"0 0 24 24\">\n            <circle \n              className=\"opacity-25\" \n              cx=\"12\" \n              cy=\"12\" \n              r=\"10\" \n              stroke=\"currentColor\" \n              strokeWidth=\"4\"\n            />\n            <path \n              className=\"opacity-75\" \n              fill=\"currentColor\" \n              d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n            />\n          </svg>\n        </div>\n      ) : (\n        <div className=\"relative\">\n          {/* Heart Icon with Airbnb-style animation */}\n          <svg \n            className={`\n              ${iconSizes[size]} \n              transition-all duration-300 ease-out\n              ${!user\n                ? isHovered \n                  ? 'text-gray-500 scale-105' \n                  : 'text-gray-400'\n                : isFavorited \n                  ? 'text-red-500 scale-110' \n                  : isHovered \n                    ? 'text-red-400 scale-105' \n                    : 'text-gray-600'\n              }\n              ${isAnimating && user ? 'heart-pop' : ''}\n              ${isFavorited && isHovered && user ? 'heart-beat' : ''}\n            `}\n            fill={user && isFavorited ? 'currentColor' : 'none'} \n            stroke=\"currentColor\" \n            viewBox=\"0 0 24 24\"\n          >\n            <path \n              strokeLinecap=\"round\" \n              strokeLinejoin=\"round\" \n              strokeWidth={user && isFavorited ? \"0\" : \"2\"} \n              d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" \n            />\n          </svg>\n          \n          {/* Animated pulse effect when favorited */}\n          {user && isFavorited && (\n            <div className=\"absolute inset-0 rounded-full\">\n              <svg \n                className={`${iconSizes[size]} text-red-500 animate-ping opacity-30`}\n                fill=\"currentColor\" \n                viewBox=\"0 0 24 24\"\n              >\n                <path d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" />\n              </svg>\n            </div>\n          )}\n        </div>\n      )}\n    </button>\n  );\n};\n\nexport default FavoriteButton;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,CAAEC,UAAU,CAAEC,aAAa,KAAQ,OAAO,CAC7E,OAASC,QAAQ,KAAQ,iBAAiB,CAC1C,OAASC,eAAe,KAAQ,wBAAwB,CACxD,MAAO,CAAAC,gBAAgB,KAAM,8BAA8B,CAC3D,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,mBAAmB,KAAQ,8BAA8B,CAElE;AAAA,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBACA,KAAM,CAAAC,gBAAgB,cAAGV,aAAa,CAAC,CAAC,CAExC;AACA,MAAO,MAAM,CAAAW,iBAAiB,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAC5C,KAAM,CAACE,SAAS,CAAEC,YAAY,CAAC,CAAGlB,QAAQ,CAAC,GAAI,CAAAmB,GAAG,CAAC,CAAC,CAAC,CACrD,KAAM,CAACC,IAAI,CAAEC,OAAO,CAAC,CAAGrB,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACsB,SAAS,CAAEC,YAAY,CAAC,CAAGvB,QAAQ,CAAC,IAAI,CAAC,CAEhDC,SAAS,CAAC,IAAM,CACduB,oBAAoB,CAAC,CAAC,CAEtB;AACA,KAAM,CAAAC,WAAW,CAAGpB,eAAe,CAAC,MAAOqB,KAAK,CAAEC,OAAO,GAAK,KAAAC,aAAA,CAC5DC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAEJ,KAAK,CAAEC,OAAO,SAAPA,OAAO,kBAAAC,aAAA,CAAPD,OAAO,CAAEP,IAAI,UAAAQ,aAAA,iBAAbA,aAAA,CAAeG,KAAK,CAAC,CAElE,GAAIL,KAAK,GAAK,WAAW,EAAIA,KAAK,GAAK,iBAAiB,EAAIA,KAAK,GAAK,iBAAiB,CAAE,CACvFL,OAAO,CAAC,CAAAM,OAAO,SAAPA,OAAO,iBAAPA,OAAO,CAAEP,IAAI,GAAI,IAAI,CAAC,CAC9B,GAAIO,OAAO,SAAPA,OAAO,WAAPA,OAAO,CAAEP,IAAI,CAAE,CACjB,KAAM,CAAAY,MAAM,CAAG,KAAM,CAAA1B,gBAAgB,CAAC2B,gBAAgB,CAACN,OAAO,CAACP,IAAI,CAACc,EAAE,CAAC,CACvE,GAAIF,MAAM,CAACG,OAAO,CAAE,CAClB,KAAM,CAAAC,YAAY,CAAG,GAAI,CAAAjB,GAAG,CAC1Ba,MAAM,CAACK,IAAI,CAACC,GAAG,CAACC,GAAG,EAAI,GAAGA,GAAG,CAACC,YAAY,IAAID,GAAG,CAACE,UAAU,EAAE,CAChE,CAAC,CACDvB,YAAY,CAACkB,YAAY,CAAC,CAC5B,CACF,CACF,CAAC,IAAM,IAAIV,KAAK,GAAK,YAAY,CAAE,CACjCL,OAAO,CAAC,IAAI,CAAC,CACbH,YAAY,CAAC,GAAI,CAAAC,GAAG,CAAC,CAAC,CAAC,CACzB,CAEAI,YAAY,CAAC,KAAK,CAAC,CACrB,CAAC,CAAC,CAEF,MAAO,CAAAE,WAAW,CACpB,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAD,oBAAoB,CAAG,KAAAA,CAAA,GAAY,CACvC,GAAI,CACFK,OAAO,CAACC,GAAG,CAAC,kCAAkC,CAAC,CAE/C;AACA,KAAM,CAAAY,UAAU,CAAG,KAAM,CAAAlC,mBAAmB,CAAC,CAAC,CAC9C,GAAI,CAACkC,UAAU,CAACP,OAAO,EAAIO,UAAU,CAACC,UAAU,CAAE,CAChDd,OAAO,CAACe,IAAI,CAAC,0CAA0C,CAAC,CAC1D,CAEA,KAAM,CAAEP,IAAI,CAAE,CAAEjB,IAAK,CAAC,CAAEyB,KAAK,CAAEC,SAAU,CAAC,CAAG,KAAM,CAAA1C,QAAQ,CAAC2C,IAAI,CAACC,OAAO,CAAC,CAAC,CAE1E,GAAIF,SAAS,CAAE,KAAAG,kBAAA,CACb;AACA,IAAAA,kBAAA,CAAIH,SAAS,CAACI,OAAO,UAAAD,kBAAA,WAAjBA,kBAAA,CAAmBE,QAAQ,CAAC,sBAAsB,CAAC,CAAE,CACvDtB,OAAO,CAACC,GAAG,CAAC,yCAAyC,CAAC,CACxD,CAAC,IAAM,CACLD,OAAO,CAACgB,KAAK,CAAC,uBAAuB,CAAEC,SAAS,CAAC,CACnD,CACAzB,OAAO,CAAC,IAAI,CAAC,CACbE,YAAY,CAAC,KAAK,CAAC,CACnB,OACF,CAEAF,OAAO,CAACD,IAAI,CAAC,CACbS,OAAO,CAACC,GAAG,CAAC,iBAAiB,CAAEV,IAAI,CAAGA,IAAI,CAACW,KAAK,CAAG,SAAS,CAAC,CAE7D,GAAIX,IAAI,CAAE,CACRS,OAAO,CAACC,GAAG,CAAC,gCAAgC,CAAEV,IAAI,CAACc,EAAE,CAAC,CACtD,KAAM,CAAAF,MAAM,CAAG,KAAM,CAAA1B,gBAAgB,CAAC2B,gBAAgB,CAACb,IAAI,CAACc,EAAE,CAAC,CAE/D,GAAIF,MAAM,CAACG,OAAO,CAAE,CAClB,KAAM,CAAAC,YAAY,CAAG,GAAI,CAAAjB,GAAG,CAC1Ba,MAAM,CAACK,IAAI,CAACC,GAAG,CAACC,GAAG,EAAI,GAAGA,GAAG,CAACC,YAAY,IAAID,GAAG,CAACE,UAAU,EAAE,CAChE,CAAC,CACDvB,YAAY,CAACkB,YAAY,CAAC,CAC1BP,OAAO,CAACC,GAAG,CAAC,qBAAqB,CAAEM,YAAY,CAACgB,IAAI,CAAE,OAAO,CAAC,CAChE,CAAC,IAAM,CACLvB,OAAO,CAACgB,KAAK,CAAC,4BAA4B,CAAEb,MAAM,CAACa,KAAK,CAAC,CACzD;AACA,GAAIb,MAAM,CAACa,KAAK,CAACM,QAAQ,CAAC,0CAA0C,CAAC,CAAE,CACrEtB,OAAO,CAACe,IAAI,CAAC,yFAAyF,CAAC,CACzG,CACF,CACF,CAAC,IAAM,CACL1B,YAAY,CAAC,GAAI,CAAAC,GAAG,CAAC,CAAC,CAAC,CACzB,CACF,CAAE,MAAO0B,KAAK,CAAE,CACdhB,OAAO,CAACgB,KAAK,CAAC,iCAAiC,CAAEA,KAAK,CAAC,CACzD,CAAC,OAAS,CACRtB,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAED,KAAM,CAAA8B,cAAc,CAAG,KAAAA,CAAOC,SAAS,CAAEC,WAAW,GAAK,CACvD,GAAI,CAACnC,IAAI,CAAE,MAAO,CAAEe,OAAO,CAAE,KAAK,CAAEU,KAAK,CAAE,wBAAyB,CAAC,CAErE,KAAM,CAAAW,WAAW,CAAG,GAAGD,WAAW,IAAID,SAAS,EAAE,CACjD,KAAM,CAAAG,WAAW,CAAGxC,SAAS,CAACyC,GAAG,CAACF,WAAW,CAAC,CAE9C;AACA,KAAM,CAAAG,YAAY,CAAG,GAAI,CAAAxC,GAAG,CAACF,SAAS,CAAC,CACvC,GAAIwC,WAAW,CAAE,CACfE,YAAY,CAACC,MAAM,CAACJ,WAAW,CAAC,CAClC,CAAC,IAAM,CACLG,YAAY,CAACE,GAAG,CAACL,WAAW,CAAC,CAC/B,CACAtC,YAAY,CAACyC,YAAY,CAAC,CAE1B,GAAI,CACF9B,OAAO,CAACC,GAAG,CAAC,uBAAuB,CAAE,CAAEwB,SAAS,CAAEC,WAAW,CAAEE,WAAY,CAAC,CAAC,CAC7E,KAAM,CAAAzB,MAAM,CAAG,KAAM,CAAA1B,gBAAgB,CAAC+C,cAAc,CAACjC,IAAI,CAACc,EAAE,CAAEoB,SAAS,CAAEC,WAAW,CAAC,CAErF,GAAI,CAACvB,MAAM,CAACG,OAAO,CAAE,CACnBN,OAAO,CAACgB,KAAK,CAAC,8BAA8B,CAAEb,MAAM,CAACa,KAAK,CAAC,CAC3D;AACA3B,YAAY,CAACD,SAAS,CAAC,CACvB,MAAO,CAAAe,MAAM,CACf,CAEAH,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC,CAC9C,MAAO,CAAAE,MAAM,CACf,CAAE,MAAOa,KAAK,CAAE,CACdhB,OAAO,CAACgB,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CAClD;AACA3B,YAAY,CAACD,SAAS,CAAC,CACvB,MAAO,CAAEkB,OAAO,CAAE,KAAK,CAAEU,KAAK,CAAEA,KAAK,CAACK,OAAQ,CAAC,CACjD,CACF,CAAC,CAED,KAAM,CAAAY,UAAU,CAAGA,CAACR,SAAS,CAAEC,WAAW,GAAK,CAC7C,MAAO,CAAAtC,SAAS,CAACyC,GAAG,CAAC,GAAGH,WAAW,IAAID,SAAS,EAAE,CAAC,CACrD,CAAC,CAED,mBACE5C,IAAA,CAACG,gBAAgB,CAACkD,QAAQ,EAACC,KAAK,CAAE,CAChC5C,IAAI,CACJH,SAAS,CACTK,SAAS,CACT+B,cAAc,CACdS,UAAU,CACVG,gBAAgB,CAAEzC,oBACpB,CAAE,CAAAR,QAAA,CACCA,QAAQ,CACgB,CAAC,CAEhC,CAAC,CAED;AACA,MAAO,MAAM,CAAAkD,YAAY,CAAGA,CAAA,GAAM,CAChC,KAAM,CAAAC,OAAO,CAAGjE,UAAU,CAACW,gBAAgB,CAAC,CAC5C,GAAI,CAACsD,OAAO,CAAE,CACZ,KAAM,IAAI,CAAAC,KAAK,CAAC,sDAAsD,CAAC,CACzE,CACA,MAAO,CAAAD,OAAO,CAChB,CAAC,CAED,KAAM,CAAAE,cAAc,CAAGC,KAAA,EAOjB,IAPkB,CACtBhB,SAAS,CACTC,WAAW,CACXgB,SAAS,CAAG,EAAE,CACdnB,IAAI,CAAG,IAAI,CACXoB,WAAW,CAAG,IAAI,CAClBC,QAAQ,CAAG,IACb,CAAC,CAAAH,KAAA,CACC,KAAM,CAAChD,SAAS,CAAEC,YAAY,CAAC,CAAGvB,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC0E,SAAS,CAAEC,YAAY,CAAC,CAAG3E,QAAQ,CAAC,KAAK,CAAC,CACjD,KAAM,CAAC4E,WAAW,CAAEC,cAAc,CAAC,CAAG7E,QAAQ,CAAC,KAAK,CAAC,CACrD,KAAM,CAAA8E,QAAQ,CAAGvE,WAAW,CAAC,CAAC,CAE9B;AACA,KAAM,CAAEa,IAAI,CAAE0C,UAAU,CAAET,cAAc,CAAE0B,qBAAsB,CAAC,CAAGb,YAAY,CAAC,CAAC,CAClF,KAAM,CAAAT,WAAW,CAAGK,UAAU,CAACR,SAAS,CAAEC,WAAW,CAAC,CAEtD;AACA,KAAM,CAAAyB,WAAW,CAAG,CAClBC,EAAE,CAAE,SAAS,CACbC,EAAE,CAAE,WAAW,CACfC,EAAE,CAAE,WACN,CAAC,CAED,KAAM,CAAAC,SAAS,CAAG,CAChBH,EAAE,CAAE,SAAS,CACbC,EAAE,CAAE,SAAS,CACbC,EAAE,CAAE,SACN,CAAC,CAED,KAAM,CAAAE,oBAAoB,CAAG,KAAO,CAAAC,CAAC,EAAK,CACxCA,CAAC,CAACC,cAAc,CAAC,CAAC,CAAE;AACpBD,CAAC,CAACE,eAAe,CAAC,CAAC,CAAE;AAErB3D,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAE,CAAEwB,SAAS,CAAEC,WAAW,CAAEnC,IAAI,CAAE,CAAC,CAACA,IAAI,CAAEqC,WAAY,CAAC,CAAC,CAE5F,GAAI,CAACrC,IAAI,CAAE,CACTS,OAAO,CAACC,GAAG,CAAC,6CAA6C,CAAC,CAC1DgD,QAAQ,CAAC,SAAS,CAAC,CACnB,OACF,CAEA,GAAIxD,SAAS,CAAE,CACbO,OAAO,CAACC,GAAG,CAAC,mCAAmC,CAAC,CAChD,OACF,CAEAP,YAAY,CAAC,IAAI,CAAC,CAClBsD,cAAc,CAAC,IAAI,CAAC,CAEpB,GAAI,CACFhD,OAAO,CAACC,GAAG,CAAC,qCAAqC,CAAC,CAClD,KAAM,CAAAE,MAAM,CAAG,KAAM,CAAA+C,qBAAqB,CAACzB,SAAS,CAAEC,WAAW,CAAC,CAElE,GAAIvB,MAAM,CAACG,OAAO,CAAE,CAClBN,OAAO,CAACC,GAAG,CAAC,iCAAiC,CAAC,CAE9C;AACA,GAAI2C,QAAQ,CAAE,CACZA,QAAQ,CAAC,CAAChB,WAAW,CAAEH,SAAS,CAAEC,WAAW,CAAC,CAChD,CAEA;AACA,KAAM,CAAAkC,MAAM,CAAGhC,WAAW,CAAG,wBAAwB,CAAG,oBAAoB,CAC5E5B,OAAO,CAACC,GAAG,CAAC,IAAI,CAAE2D,MAAM,CAAC,CAEzB;AACAC,UAAU,CAAC,IAAMb,cAAc,CAAC,KAAK,CAAC,CAAE,GAAG,CAAC,CAC9C,CAAC,IAAM,CACLA,cAAc,CAAC,KAAK,CAAC,CACrBhD,OAAO,CAACgB,KAAK,CAAC,4BAA4B,CAAEb,MAAM,CAACa,KAAK,CAAC,CAEzD;AACA,GAAIb,MAAM,CAACa,KAAK,CAACM,QAAQ,CAAC,0CAA0C,CAAC,CAAE,CACrEtB,OAAO,CAACgB,KAAK,CAAC,+CAA+C,CAAC,CAChE,CACF,CACF,CAAE,MAAOA,KAAK,CAAE,CACdgC,cAAc,CAAC,KAAK,CAAC,CACrBhD,OAAO,CAACgB,KAAK,CAAC,4BAA4B,CAAEA,KAAK,CAAC,CACpD,CAAC,OAAS,CACRtB,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAED;AACA,GAAI,CAAC+B,SAAS,EAAI,CAACC,WAAW,CAAE,CAC9B,MAAO,KAAI,CACb,CAEA,mBACE7C,IAAA,WACEiF,OAAO,CAAEN,oBAAqB,CAC9BO,QAAQ,CAAEtE,SAAU,CACpBuE,YAAY,CAAEA,CAAA,GAAMlB,YAAY,CAAC,IAAI,CAAE,CACvCmB,YAAY,CAAEA,CAAA,GAAMnB,YAAY,CAAC,KAAK,CAAE,CACxCJ,SAAS,CAAE;AACjB,UAAUS,WAAW,CAAC5B,IAAI,CAAC;AAC3B;AACA;AACA;AACA;AACA,UAAUsB,SAAS,CAAG,WAAW,CAAG,WAAW;AAC/C;AACA,UAAU,CAACtD,IAAI,CACH,0EAA0E,CAC1EqC,WAAW,CACT,uEAAuE,CACvE,0EAA0E;AACxF,UACUnC,SAAS,CAAG,+BAA+B,CAAG,gBAAgB;AACxE,UAAUsD,WAAW,EAAInB,WAAW,EAAIrC,IAAI,CAAG,eAAe,CAAG,EAAE;AACnE;AACA;AACA,UAAUmD,SAAS;AACnB,OAAQ,CACFwB,KAAK,CAAEvB,WAAW,CAAI,CAACpD,IAAI,CAAG,6BAA6B,CAAIqC,WAAW,CAAG,uBAAuB,CAAG,kBAAmB,CAAI,EAAG,CACjI,aAAY,CAACrC,IAAI,CAAG,6BAA6B,CAAIqC,WAAW,CAAG,uBAAuB,CAAG,kBAAoB,CAAAzC,QAAA,CAEhHM,SAAS,cACRZ,IAAA,QAAK6D,SAAS,CAAE,GAAGa,SAAS,CAAChC,IAAI,CAAC,eAAgB,CAAApC,QAAA,cAChDJ,KAAA,QAAK2D,SAAS,CAAC,4BAA4B,CAACyB,IAAI,CAAC,MAAM,CAACC,OAAO,CAAC,WAAW,CAAAjF,QAAA,eACzEN,IAAA,WACE6D,SAAS,CAAC,YAAY,CACtB2B,EAAE,CAAC,IAAI,CACPC,EAAE,CAAC,IAAI,CACPC,CAAC,CAAC,IAAI,CACNC,MAAM,CAAC,cAAc,CACrBC,WAAW,CAAC,GAAG,CAChB,CAAC,cACF5F,IAAA,SACE6D,SAAS,CAAC,YAAY,CACtByB,IAAI,CAAC,cAAc,CACnBO,CAAC,CAAC,iHAAiH,CACpH,CAAC,EACC,CAAC,CACH,CAAC,cAEN3F,KAAA,QAAK2D,SAAS,CAAC,UAAU,CAAAvD,QAAA,eAEvBN,IAAA,QACE6D,SAAS,CAAE;AACvB,gBAAgBa,SAAS,CAAChC,IAAI,CAAC;AAC/B;AACA,gBAAgB,CAAChC,IAAI,CACHsD,SAAS,CACP,yBAAyB,CACzB,eAAe,CACjBjB,WAAW,CACT,wBAAwB,CACxBiB,SAAS,CACP,wBAAwB,CACxB,eAAe;AACrC,gBACgBE,WAAW,EAAIxD,IAAI,CAAG,WAAW,CAAG,EAAE;AACtD,gBAAgBqC,WAAW,EAAIiB,SAAS,EAAItD,IAAI,CAAG,YAAY,CAAG,EAAE;AACpE,aAAc,CACF4E,IAAI,CAAE5E,IAAI,EAAIqC,WAAW,CAAG,cAAc,CAAG,MAAO,CACpD4C,MAAM,CAAC,cAAc,CACrBJ,OAAO,CAAC,WAAW,CAAAjF,QAAA,cAEnBN,IAAA,SACE8F,aAAa,CAAC,OAAO,CACrBC,cAAc,CAAC,OAAO,CACtBH,WAAW,CAAElF,IAAI,EAAIqC,WAAW,CAAG,GAAG,CAAG,GAAI,CAC7C8C,CAAC,CAAC,6HAA6H,CAChI,CAAC,CACC,CAAC,CAGLnF,IAAI,EAAIqC,WAAW,eAClB/C,IAAA,QAAK6D,SAAS,CAAC,+BAA+B,CAAAvD,QAAA,cAC5CN,IAAA,QACE6D,SAAS,CAAE,GAAGa,SAAS,CAAChC,IAAI,CAAC,uCAAwC,CACrE4C,IAAI,CAAC,cAAc,CACnBC,OAAO,CAAC,WAAW,CAAAjF,QAAA,cAEnBN,IAAA,SAAM6F,CAAC,CAAC,6HAA6H,CAAE,CAAC,CACrI,CAAC,CACH,CACN,EACE,CACN,CACK,CAAC,CAEb,CAAC,CAED,cAAe,CAAAlC,cAAc","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}