{"ast":null,"code":"// Security utilities for role-based access control\nimport React,{useEffect,useState}from'react';import{Navigate}from'react-router-dom';import authManager from'./auth-manager';// Higher-order component for role-based protection\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const withRoleProtection=(Component,requiredRole)=>{return function ProtectedComponent(props){const[loading,setLoading]=useState(true);const[authorized,setAuthorized]=useState(false);const[userRole,setUserRole]=useState(null);useEffect(()=>{const checkAuthorization=async()=>{try{var _user$user_metadata;const user=authManager.getUser();if(!user){setAuthorized(false);setLoading(false);return;}// Get user role from user metadata\nconst role=((_user$user_metadata=user.user_metadata)===null||_user$user_metadata===void 0?void 0:_user$user_metadata.role)||user.role;setUserRole(role);// Check if user has required role\nif(role===requiredRole||role==='admin'){setAuthorized(true);}else{setAuthorized(false);}}catch(error){console.error('Authorization check failed:',error);setAuthorized(false);}finally{setLoading(false);}};checkAuthorization();// Subscribe to auth changes\nconst unsubscribe=authManager.subscribe(()=>{checkAuthorization();});return()=>unsubscribe();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#5EB47C] mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Verifying access...\"})]})});}if(!authorized){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen bg-gray-50 flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"max-w-md w-full bg-white shadow-lg rounded-lg p-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"w-6 h-6 text-red-600\",fill:\"none\",stroke:\"currentColor\",viewBox:\"0 0 24 24\",children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",strokeWidth:\"2\",d:\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\"})})}),/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-medium text-gray-900 mb-2\",children:\"Access Denied\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500 mb-4\",children:[\"You don't have permission to access this page. Required role: \",requiredRole,userRole&&` (Your role: ${userRole})`]}),/*#__PURE__*/_jsx(\"a\",{href:\"/\",className:\"inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-[#5EB47C] border border-transparent rounded-md hover:bg-[#4A9A64]\",children:\"Go to Home\"})]})})});}return/*#__PURE__*/_jsx(Component,{...props});};};// Hook for checking permissions\nexport const usePermission=requiredRole=>{const[hasPermission,setHasPermission]=useState(false);const[loading,setLoading]=useState(true);useEffect(()=>{const checkPermission=()=>{var _user$user_metadata2;const user=authManager.getUser();if(!user){setHasPermission(false);setLoading(false);return;}const role=((_user$user_metadata2=user.user_metadata)===null||_user$user_metadata2===void 0?void 0:_user$user_metadata2.role)||user.role;setHasPermission(role===requiredRole||role==='admin');setLoading(false);};checkPermission();const unsubscribe=authManager.subscribe(()=>{checkPermission();});return()=>unsubscribe();},[requiredRole]);return{hasPermission,loading};};export default{withRoleProtection,usePermission};","map":{"version":3,"names":["React","useEffect","useState","Navigate","authManager","jsx","_jsx","jsxs","_jsxs","withRoleProtection","Component","requiredRole","ProtectedComponent","props","loading","setLoading","authorized","setAuthorized","userRole","setUserRole","checkAuthorization","_user$user_metadata","user","getUser","role","user_metadata","error","console","unsubscribe","subscribe","className","children","fill","stroke","viewBox","strokeLinecap","strokeLinejoin","strokeWidth","d","href","usePermission","hasPermission","setHasPermission","checkPermission","_user$user_metadata2"],"sources":["/workspace/src/lib/security.js"],"sourcesContent":["// Security utilities for role-based access control\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport authManager from './auth-manager';\n\n// Higher-order component for role-based protection\nexport const withRoleProtection = (Component, requiredRole) => {\n  return function ProtectedComponent(props) {\n    const [loading, setLoading] = useState(true);\n    const [authorized, setAuthorized] = useState(false);\n    const [userRole, setUserRole] = useState(null);\n\n    useEffect(() => {\n      const checkAuthorization = async () => {\n        try {\n          const user = authManager.getUser();\n          \n          if (!user) {\n            setAuthorized(false);\n            setLoading(false);\n            return;\n          }\n\n          // Get user role from user metadata\n          const role = user.user_metadata?.role || user.role;\n          setUserRole(role);\n\n          // Check if user has required role\n          if (role === requiredRole || role === 'admin') {\n            setAuthorized(true);\n          } else {\n            setAuthorized(false);\n          }\n        } catch (error) {\n          console.error('Authorization check failed:', error);\n          setAuthorized(false);\n        } finally {\n          setLoading(false);\n        }\n      };\n\n      checkAuthorization();\n\n      // Subscribe to auth changes\n      const unsubscribe = authManager.subscribe(() => {\n        checkAuthorization();\n      });\n\n      return () => unsubscribe();\n    }, []);\n\n    if (loading) {\n      return (\n        <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#5EB47C] mx-auto mb-4\"></div>\n            <p className=\"text-gray-600\">Verifying access...</p>\n          </div>\n        </div>\n      );\n    }\n\n    if (!authorized) {\n      return (\n        <div className=\"min-h-screen bg-gray-50 flex items-center justify-center\">\n          <div className=\"max-w-md w-full bg-white shadow-lg rounded-lg p-6\">\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center w-12 h-12 mx-auto bg-red-100 rounded-full mb-4\">\n                <svg className=\"w-6 h-6 text-red-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z\" />\n                </svg>\n              </div>\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">Access Denied</h3>\n              <p className=\"text-sm text-gray-500 mb-4\">\n                You don't have permission to access this page. Required role: {requiredRole}\n                {userRole && ` (Your role: ${userRole})`}\n              </p>\n              <a\n                href=\"/\"\n                className=\"inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-[#5EB47C] border border-transparent rounded-md hover:bg-[#4A9A64]\"\n              >\n                Go to Home\n              </a>\n            </div>\n          </div>\n        </div>\n      );\n    }\n\n    return <Component {...props} />;\n  };\n};\n\n// Hook for checking permissions\nexport const usePermission = (requiredRole) => {\n  const [hasPermission, setHasPermission] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    const checkPermission = () => {\n      const user = authManager.getUser();\n      if (!user) {\n        setHasPermission(false);\n        setLoading(false);\n        return;\n      }\n\n      const role = user.user_metadata?.role || user.role;\n      setHasPermission(role === requiredRole || role === 'admin');\n      setLoading(false);\n    };\n\n    checkPermission();\n\n    const unsubscribe = authManager.subscribe(() => {\n      checkPermission();\n    });\n\n    return () => unsubscribe();\n  }, [requiredRole]);\n\n  return { hasPermission, loading };\n};\n\nexport default { withRoleProtection, usePermission };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}